!function(){function _extend(target,source){if(!source||"function"==typeof source)return target;for(var attr in source)target[attr]=source[attr];return target}function _each(object,callback,args){var name,i=0,length=object.length,isObj=void 0===length||"function"==typeof object;if(args)if(isObj){for(name in object)if(callback.apply(object[name],args)===!1)break}else for(;length>i&&callback.apply(object[i++],args)!==!1;);else if(isObj){for(name in object)if(callback.call(object[name],name,object[name])===!1)break}else for(;length>i&&callback.call(object[i],i,object[i++])!==!1;);return object}function _escape(data){return"string"==typeof data?data.replace(/[&<>"'\/]/g,function(s){return _entityMap[s]}):data}function _ajax(options){var getXhr=function(callback){if(window.XMLHttpRequest)return callback(null,new XMLHttpRequest);if(window.ActiveXObject)try{return callback(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(e){return callback(null,new ActiveXObject("Microsoft.XMLHTTP"))}return callback(new Error)},encodeUsingUrlEncoding=function(data){if("string"==typeof data)return data;var result=[];for(var dataItem in data)data.hasOwnProperty(dataItem)&&result.push(encodeURIComponent(dataItem)+"="+encodeURIComponent(data[dataItem]));return result.join("&")},utf8=function(text){text=text.replace(/\r\n/g,"\n");for(var result="",i=0;i<text.length;i++){var c=text.charCodeAt(i);128>c?result+=String.fromCharCode(c):c>127&&2048>c?(result+=String.fromCharCode(c>>6|192),result+=String.fromCharCode(63&c|128)):(result+=String.fromCharCode(c>>12|224),result+=String.fromCharCode(c>>6&63|128),result+=String.fromCharCode(63&c|128))}return result},base64=function(text){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";text=utf8(text);var chr1,chr2,chr3,enc1,enc2,enc3,enc4,result="",i=0;do chr1=text.charCodeAt(i++),chr2=text.charCodeAt(i++),chr3=text.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),result+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<text.length);return result},mergeHeaders=function(){for(var result=arguments[0],i=1;i<arguments.length;i++){var currentHeaders=arguments[i];for(var header in currentHeaders)currentHeaders.hasOwnProperty(header)&&(result[header]=currentHeaders[header])}return result},ajax=function(method,url,options,callback){"function"==typeof options&&(callback=options,options={}),options.cache=options.cache||!1,options.data=options.data||{},options.headers=options.headers||{},options.jsonp=options.jsonp||!1,options.async=void 0===options.async?!0:options.async;var payload,headers=mergeHeaders({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},ajax.headers,options.headers);if(payload="application/json"===headers["content-type"]?JSON.stringify(options.data):encodeUsingUrlEncoding(options.data),"GET"===method){var queryString=[];if(payload&&(queryString.push(payload),payload=null),options.cache||queryString.push("_="+(new Date).getTime()),options.jsonp&&(queryString.push("callback="+options.jsonp),queryString.push("jsonp="+options.jsonp)),queryString=queryString.join("&"),queryString.length>1&&(url+=url.indexOf("?")>-1?"&"+queryString:"?"+queryString),options.jsonp){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");return script.type="text/javascript",script.src=url,head.appendChild(script),void 0}}getXhr(function(err,xhr){if(err)return callback(err);xhr.open(method,url,options.async);for(var header in headers)headers.hasOwnProperty(header)&&xhr.setRequestHeader(header,headers[header]);xhr.onreadystatechange=function(){if(4===xhr.readyState){var data=xhr.responseText||"";if(!callback)return;callback(xhr.status,{text:function(){return data},json:function(){return JSON.parse(data)}})}},xhr.send(payload)})},http={authBasic:function(username,password){ajax.headers.Authorization="Basic "+base64(username+":"+password)},connect:function(url,options,callback){return ajax("CONNECT",url,options,callback)},del:function(url,options,callback){return ajax("DELETE",url,options,callback)},get:function(url,options,callback){return ajax("GET",url,options,callback)},head:function(url,options,callback){return ajax("HEAD",url,options,callback)},headers:function(headers){ajax.headers=headers||{}},isAllowed:function(url,verb,callback){this.options(url,function(status,data){callback(-1!==data.text().indexOf(verb))})},options:function(url,options,callback){return ajax("OPTIONS",url,options,callback)},patch:function(url,options,callback){return ajax("PATCH",url,options,callback)},post:function(url,options,callback){return ajax("POST",url,options,callback)},put:function(url,options,callback){return ajax("PUT",url,options,callback)},trace:function(url,options,callback){return ajax("TRACE",url,options,callback)}},methode=options.type?options.type.toLowerCase():"get";http[methode](options.url,options,function(status,data){200===status?options.success(data.json(),status,null):options.error(data.text(),status,null)})}function init(options,cb){"function"==typeof options&&(cb=options,options={}),options=options||{},f.extend(o,options),"string"==typeof o.ns&&(o.ns={namespaces:[o.ns],defaultNs:o.ns}),"string"==typeof o.fallbackNS&&(o.fallbackNS=[o.fallbackNS]),o.interpolationPrefixEscaped=f.regexEscape(o.interpolationPrefix),o.interpolationSuffixEscaped=f.regexEscape(o.interpolationSuffix),o.lng||(o.lng=f.detectLanguage()),o.lng?o.useCookie&&f.cookie.create(o.cookieName,o.lng,o.cookieExpirationTime):(o.lng=o.fallbackLng,o.useCookie&&f.cookie.remove(o.cookieName)),languages=f.toLanguages(o.lng),currentLng=languages[0],f.log("currentLng set to: "+currentLng),pluralExtensions.setCurrentLng(currentLng),$&&o.setJqueryExt&&addJqueryFunct();var deferred;if($&&$.Deferred&&(deferred=$.Deferred()),!o.resStore){var lngsToLoad=f.toLanguages(o.lng);"string"==typeof o.preload&&(o.preload=[o.preload]);for(var i=0,l=o.preload.length;l>i;i++)for(var pres=f.toLanguages(o.preload[i]),y=0,len=pres.length;len>y;y++)lngsToLoad.indexOf(pres[y])<0&&lngsToLoad.push(pres[y]);return i18n.sync.load(lngsToLoad,o,function(err,store){resStore=store,cb&&cb(translate),deferred&&deferred.resolve()}),deferred?deferred.promise():void 0}return resStore=o.resStore,cb&&cb(translate),deferred&&deferred.resolve(),deferred?deferred.promise():void 0}function preload(lngs,cb){"string"==typeof lngs&&(lngs=[lngs]);for(var i=0,l=lngs.length;l>i;i++)o.preload.indexOf(lngs[i])<0&&o.preload.push(lngs[i]);return init(cb)}function addResourceBundle(lng,ns,resources){"string"!=typeof ns?(resources=ns,ns=o.ns.defaultNs):o.ns.namespaces.indexOf(ns)<0&&o.ns.namespaces.push(ns),resStore[lng]=resStore[lng]||{},resStore[lng][ns]=resStore[lng][ns]||{},f.extend(resStore[lng][ns],resources)}function setDefaultNamespace(ns){o.ns.defaultNs=ns}function loadNamespace(namespace,cb){loadNamespaces([namespace],cb)}function loadNamespaces(namespaces,cb){var opts={dynamicLoad:o.dynamicLoad,resGetPath:o.resGetPath,getAsync:o.getAsync,customLoad:o.customLoad,ns:{namespaces:namespaces,defaultNs:""}},lngsToLoad=f.toLanguages(o.lng);"string"==typeof o.preload&&(o.preload=[o.preload]);for(var i=0,l=o.preload.length;l>i;i++)for(var pres=f.toLanguages(o.preload[i]),y=0,len=pres.length;len>y;y++)lngsToLoad.indexOf(pres[y])<0&&lngsToLoad.push(pres[y]);for(var lngNeedLoad=[],a=0,lenA=lngsToLoad.length;lenA>a;a++){var needLoad=!1,resSet=resStore[lngsToLoad[a]];if(resSet)for(var b=0,lenB=namespaces.length;lenB>b;b++)resSet[namespaces[b]]||(needLoad=!0);else needLoad=!0;needLoad&&lngNeedLoad.push(lngsToLoad[a])}lngNeedLoad.length?i18n.sync._fetch(lngNeedLoad,opts,function(err,store){var todo=namespaces.length*lngNeedLoad.length;f.each(namespaces,function(nsIndex,nsValue){o.ns.namespaces.indexOf(nsValue)<0&&o.ns.namespaces.push(nsValue),f.each(lngNeedLoad,function(lngIndex,lngValue){resStore[lngValue]=resStore[lngValue]||{},resStore[lngValue][nsValue]=store[lngValue][nsValue],todo--,0===todo&&cb&&(o.useLocalStorage&&i18n.sync._storeLocal(resStore),cb())})})}):cb&&cb()}function setLng(lng,cb){return init({lng:lng},cb)}function lng(){return currentLng}function addJqueryFunct(){function parse(ele,key,options){if(0!==key.length){var attr="text";if(0===key.indexOf("[")){var parts=key.split("]");key=parts[1],attr=parts[0].substr(1,parts[0].length-1)}key.indexOf(";")===key.length-1&&(key=key.substr(0,key.length-2));var optionsToUse;"html"===attr?(optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.html()},options):options,ele.html($.t(key,optionsToUse))):"text"===attr?(optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.text()},options):options,ele.text($.t(key,optionsToUse))):(optionsToUse=o.defaultValueFromContent?$.extend({defaultValue:ele.attr(attr)},options):options,ele.attr(attr,$.t(key,optionsToUse)))}}function localize(ele,options){var key=ele.attr(o.selectorAttr);if(key){var target=ele,targetSelector=ele.data("i18n-target");if(targetSelector&&(target=ele.find(targetSelector)||ele),options||o.useDataAttrOptions!==!0||(options=ele.data("i18n-options")),options=options||{},key.indexOf(";")>=0){var keys=key.split(";");$.each(keys,function(m,k){""!==k&&parse(target,k,options)})}else parse(target,key,options);o.useDataAttrOptions===!0&&ele.data("i18n-options",options)}}$.t=$.t||translate,$.fn.i18n=function(options){return this.each(function(){localize($(this),options);var elements=$(this).find("["+o.selectorAttr+"]");elements.each(function(){localize($(this),options)})})}}function applyReplacement(str,replacementHash,nestedKey,options){if(!str)return str;if(options=options||replacementHash,str.indexOf(options.interpolationPrefix||o.interpolationPrefix)<0)return str;var prefix=options.interpolationPrefix?f.regexEscape(options.interpolationPrefix):o.interpolationPrefixEscaped,suffix=options.interpolationSuffix?f.regexEscape(options.interpolationSuffix):o.interpolationSuffixEscaped,unEscapingSuffix="HTML"+suffix;return f.each(replacementHash,function(key,value){var nextKey=nestedKey?nestedKey+o.keyseparator+key:key;"object"==typeof value&&null!==value?str=applyReplacement(str,value,nextKey,options):options.escapeInterpolation||o.escapeInterpolation?(str=str.replace(new RegExp([prefix,nextKey,unEscapingSuffix].join(""),"g"),value),str=str.replace(new RegExp([prefix,nextKey,suffix].join(""),"g"),f.escape(value))):str=str.replace(new RegExp([prefix,nextKey,suffix].join(""),"g"),value)}),str}function applyReuse(translated,options){var comma=",",options_open="{",options_close="}",opts=f.extend({},options);for(delete opts.postProcess;-1!=translated.indexOf(o.reusePrefix)&&(replacementCounter++,!(replacementCounter>o.maxRecursion));){var index_of_opening=translated.lastIndexOf(o.reusePrefix),index_of_end_of_closing=translated.indexOf(o.reuseSuffix,index_of_opening)+o.reuseSuffix.length,token=translated.substring(index_of_opening,index_of_end_of_closing),token_without_symbols=token.replace(o.reusePrefix,"").replace(o.reuseSuffix,"");if(-1!=token_without_symbols.indexOf(comma)){var index_of_token_end_of_closing=token_without_symbols.indexOf(comma);if(-1!=token_without_symbols.indexOf(options_open,index_of_token_end_of_closing)&&-1!=token_without_symbols.indexOf(options_close,index_of_token_end_of_closing)){var index_of_opts_opening=token_without_symbols.indexOf(options_open,index_of_token_end_of_closing),index_of_opts_end_of_closing=token_without_symbols.indexOf(options_close,index_of_opts_opening)+options_close.length;try{opts=f.extend(opts,JSON.parse(token_without_symbols.substring(index_of_opts_opening,index_of_opts_end_of_closing))),token_without_symbols=token_without_symbols.substring(0,index_of_token_end_of_closing)}catch(e){}}}var translated_token=_translate(token_without_symbols,opts);translated=translated.replace(token,translated_token)}return translated}function hasContext(options){return options.context&&"string"==typeof options.context}function needsPlural(options){return void 0!==options.count&&"string"!=typeof options.count&&1!==options.count}function exists(key,options){options=options||{};var notFound=options.defaultValue||key,found=_find(key,options);return void 0!==found||found===notFound}function translate(){return replacementCounter=0,_translate.apply(null,arguments)}function _injectSprintfProcessor(){for(var values=[],i=1;i<arguments.length;i++)values.push(arguments[i]);return{postProcess:"sprintf",sprintf:values}}function _translate(key,options){options="string"==typeof options?_injectSprintfProcessor.apply(null,arguments):options||{};var parts,notFound=options.defaultValue||key,found=_find(key,options),lngs=options.lng?f.toLanguages(options.lng):languages,ns=options.ns||o.ns.defaultNs;key.indexOf(o.nsseparator)>-1&&(parts=key.split(o.nsseparator),ns=parts[0],key=parts[1]),void 0===found&&o.sendMissing&&(options.lng?sync.postMissing(lngs[0],ns,key,notFound,lngs):sync.postMissing(o.lng,ns,key,notFound,lngs));var postProcessor=options.postProcess||o.postProcess;void 0!==found&&postProcessor&&postProcessors[postProcessor]&&(found=postProcessors[postProcessor](found,key,options));var splitNotFound=notFound;if(notFound.indexOf(o.nsseparator)>-1&&(parts=notFound.split(o.nsseparator),splitNotFound=parts[1]),splitNotFound===key&&o.parseMissingKey&&(notFound=o.parseMissingKey(notFound)),void 0===found&&(notFound=applyReplacement(notFound,options),notFound=applyReuse(notFound,options),postProcessor&&postProcessors[postProcessor])){var val=options.defaultValue||key;found=postProcessors[postProcessor](val,key,options)}return void 0!==found?found:notFound}function _find(key,options){options=options||{};var optionWithoutCount,translated,notFound=options.defaultValue||key,lngs=languages;if(!resStore)return notFound;if(options.lng&&(lngs=f.toLanguages(options.lng),!resStore[lngs[0]])){var oldAsync=o.getAsync;o.getAsync=!1,i18n.sync.load(lngs,o,function(err,store){f.extend(resStore,store),o.getAsync=oldAsync})}var ns=options.ns||o.ns.defaultNs;if(key.indexOf(o.nsseparator)>-1){var parts=key.split(o.nsseparator);ns=parts[0],key=parts[1]}if(hasContext(options)){optionWithoutCount=f.extend({},options),delete optionWithoutCount.context,optionWithoutCount.defaultValue=o.contextNotFound;var contextKey=ns+o.nsseparator+key+"_"+options.context;if(translated=translate(contextKey,optionWithoutCount),translated!=o.contextNotFound)return applyReplacement(translated,{context:options.context})}if(needsPlural(options)){optionWithoutCount=f.extend({},options),delete optionWithoutCount.count,optionWithoutCount.defaultValue=o.pluralNotFound;var pluralKey=ns+o.nsseparator+key+o.pluralSuffix,pluralExtension=pluralExtensions.get(lngs[0],options.count);if(pluralExtension>=0?pluralKey=pluralKey+"_"+pluralExtension:1===pluralExtension&&(pluralKey=ns+o.nsseparator+key),translated=translate(pluralKey,optionWithoutCount),translated!=o.pluralNotFound)return applyReplacement(translated,{count:options.count,interpolationPrefix:options.interpolationPrefix,interpolationSuffix:options.interpolationSuffix})}for(var found,keys=key.split(o.keyseparator),i=0,len=lngs.length;len>i&&void 0===found;i++){for(var l=lngs[i],x=0,value=resStore[l]&&resStore[l][ns];keys[x];)value=value&&value[keys[x]],x++;if(void 0!==value){if("string"==typeof value)value=applyReplacement(value,options),value=applyReuse(value,options);else if("[object Array]"!==Object.prototype.toString.apply(value)||o.returnObjectTrees||options.returnObjectTrees){if(null===value&&o.fallbackOnNull===!0)value=void 0;else if(null!==value)if(o.returnObjectTrees||options.returnObjectTrees){var copy={};for(var m in value)copy[m]=_translate(ns+o.nsseparator+key+o.keyseparator+m,options);value=copy}else value="key '"+ns+":"+key+" ("+l+")' returned a object instead of string.",f.log(value)}else value=value.join("\n"),value=applyReplacement(value,options),value=applyReuse(value,options);found=value}}if(void 0===found&&!options.isFallbackLookup&&(o.fallbackToDefaultNS===!0||o.fallbackNS&&o.fallbackNS.length>0))if(options.isFallbackLookup=!0,o.fallbackNS.length){for(var y=0,lenY=o.fallbackNS.length;lenY>y;y++)if(found=_find(o.fallbackNS[y]+o.nsseparator+key,options)){var foundValue=found.indexOf(o.nsseparator)>-1?found.split(o.nsseparator)[1]:found,notFoundValue=notFound.indexOf(o.nsseparator)>-1?notFound.split(o.nsseparator)[1]:notFound;if(foundValue!==notFoundValue)break}}else found=_find(key,options);return found}function detectLanguage(){var detectedLng,qsParm=[];if("undefined"!=typeof window&&(!function(){for(var query=window.location.search.substring(1),parms=query.split("&"),i=0;i<parms.length;i++){var pos=parms[i].indexOf("=");if(pos>0){var key=parms[i].substring(0,pos),val=parms[i].substring(pos+1);qsParm[key]=val}}}(),qsParm[o.detectLngQS]&&(detectedLng=qsParm[o.detectLngQS])),!detectedLng&&"undefined"!=typeof document&&o.useCookie){var c=f.cookie.read(o.cookieName);c&&(detectedLng=c)}return detectedLng||"undefined"==typeof navigator||(detectedLng=navigator.language?navigator.language:navigator.userLanguage),detectedLng}Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){"use strict";if(null==this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&1/0!=n&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(searchElement){"use strict";if(null==this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=len;arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))));for(var k=n>=0?Math.min(n,len-1):len-Math.abs(n);k>=0;k--)if(k in t&&t[k]===searchElement)return k;return-1});var currentLng,root=this,$=root.jQuery||root.Zepto,i18n={},resStore={},replacementCounter=0,languages=[];"undefined"!=typeof module&&module.exports?module.exports=i18n:($&&($.i18n=$.i18n||i18n),root.i18n=root.i18n||i18n);var o={lng:void 0,load:"all",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:"dev",fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"locales/__lng__/__ns__.json",resPostPath:"locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,setJqueryExt:!0,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",postProcess:void 0,parseMissingKey:void 0},_entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},_cookie={create:function(name,value,minutes){var expires;if(minutes){var date=new Date;date.setTime(date.getTime()+60*minutes*1e3),expires="; expires="+date.toGMTString()}else expires="";document.cookie=name+"="+value+expires+"; path=/"},read:function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},remove:function(name){this.create(name,"",-1)}},cookie_noop={create:function(){},read:function(){return null},remove:function(){}},f={extend:$?$.extend:_extend,each:$?$.each:_each,ajax:$?$.ajax:_ajax,cookie:"undefined"!=typeof document?_cookie:cookie_noop,detectLanguage:detectLanguage,escape:_escape,log:function(str){o.debug&&"undefined"!=typeof console&&console.log(str)},toLanguages:function(lng){var languages=[];if("string"==typeof lng&&lng.indexOf("-")>-1){var parts=lng.split("-");lng=o.lowerCaseLng?parts[0].toLowerCase()+"-"+parts[1].toLowerCase():parts[0].toLowerCase()+"-"+parts[1].toUpperCase(),"unspecific"!==o.load&&languages.push(lng),"current"!==o.load&&languages.push(parts[0])}else languages.push(lng);return-1===languages.indexOf(o.fallbackLng)&&o.fallbackLng&&languages.push(o.fallbackLng),languages},regexEscape:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};f.applyReplacement=applyReplacement;var sync={load:function(lngs,options,cb){options.useLocalStorage?sync._loadLocal(lngs,options,function(err,store){for(var missingLngs=[],i=0,len=lngs.length;len>i;i++)store[lngs[i]]||missingLngs.push(lngs[i]);missingLngs.length>0?sync._fetch(missingLngs,options,function(err,fetched){f.extend(store,fetched),sync._storeLocal(fetched),cb(null,store)}):cb(null,store)}):sync._fetch(lngs,options,function(err,store){cb(null,store)})},_loadLocal:function(lngs,options,cb){var store={},nowMS=(new Date).getTime();if(window.localStorage){var todo=lngs.length;f.each(lngs,function(key,lng){var local=window.localStorage.getItem("res_"+lng);local&&(local=JSON.parse(local),local.i18nStamp&&local.i18nStamp+options.localStorageExpirationTime>nowMS&&(store[lng]=local)),todo--,0===todo&&cb(null,store)})}},_storeLocal:function(store){if(window.localStorage)for(var m in store)store[m].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+m,JSON.stringify(store[m]))},_fetch:function(lngs,options,cb){var ns=options.ns,store={};if(options.dynamicLoad){var loadComplete=function(err,data){cb(null,data)};if("function"==typeof options.customLoad)options.customLoad(lngs,ns.namespaces,options,loadComplete);else{var url=applyReplacement(options.resGetPath,{lng:lngs.join("+"),ns:ns.namespaces.join("+")});f.ajax({url:url,success:function(data){f.log("loaded: "+url),loadComplete(null,data)},error:function(xhr,status,error){f.log("failed loading: "+url),loadComplete("failed loading resource.json error: "+error)},dataType:"json",async:options.getAsync})}}else{var errors,todo=ns.namespaces.length*lngs.length;f.each(ns.namespaces,function(nsIndex,nsValue){f.each(lngs,function(lngIndex,lngValue){var loadComplete=function(err,data){err&&(errors=errors||[],errors.push(err)),store[lngValue]=store[lngValue]||{},store[lngValue][nsValue]=data,todo--,0===todo&&cb(errors,store)};"function"==typeof options.customLoad?options.customLoad(lngValue,nsValue,options,loadComplete):sync._fetchOne(lngValue,nsValue,options,loadComplete)})})}},_fetchOne:function(lng,ns,options,done){var url=applyReplacement(options.resGetPath,{lng:lng,ns:ns});f.ajax({url:url,success:function(data){f.log("loaded: "+url),done(null,data)},error:function(xhr,status,error){f.log("failed loading: "+url),done(error,{})},dataType:"json",async:options.getAsync})},postMissing:function(lng,ns,key,defaultValue,lngs){var payload={};payload[key]=defaultValue;var urls=[];if("fallback"===o.sendMissingTo&&o.fallbackLng!==!1)urls.push({lng:o.fallbackLng,url:applyReplacement(o.resPostPath,{lng:o.fallbackLng,ns:ns})});else if("current"===o.sendMissingTo||"fallback"===o.sendMissingTo&&o.fallbackLng===!1)urls.push({lng:lng,url:applyReplacement(o.resPostPath,{lng:lng,ns:ns})});else if("all"===o.sendMissingTo)for(var i=0,l=lngs.length;l>i;i++)urls.push({lng:lngs[i],url:applyReplacement(o.resPostPath,{lng:lngs[i],ns:ns})});for(var y=0,len=urls.length;len>y;y++){var item=urls[y];f.ajax({url:item.url,type:o.sendType,data:payload,success:function(){f.log("posted missing key '"+key+"' to: "+item.url);for(var keys=key.split("."),x=0,value=resStore[item.lng][ns];keys[x];)value=value[keys[x]]=x===keys.length-1?defaultValue:value[keys[x]]||{},x++},error:function(){f.log("failed posting missing key '"+key+"' to: "+item.url)},dataType:"json",async:o.postAsync})}}},pluralExtensions={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(n){return Number(n>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ak:{name:"Akan",numbers:[1,2],plurals:function(n){return Number(n>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(n){return Number(n>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(n){return Number(0===n?0:1==n?1:2==n?2:n%100>=3&&10>=n%100?3:n%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(n){return Number(n>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ay:{name:"AymarÃ¡",numbers:[1],plurals:function(){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(n){return Number(1!=n)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(n){return Number(1!=n)}},bo:{name:"Tibetan",numbers:[1],plurals:function(){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(n){return Number(n>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(n){return Number(1!=n)}},cgg:{name:"Chiga",numbers:[1],plurals:function(){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(n){return Number(1==n?0:n>=2&&4>=n?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(n){return Number(1==n?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(n){return Number(1==n?0:2==n?1:8!=n&&11!=n?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(n){return Number(1!=n)}},de:{name:"German",numbers:[1,2],plurals:function(n){return Number(1!=n)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(n){return Number(1!=n)}},en:{name:"English",numbers:[1,2],plurals:function(n){return Number(1!=n)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(n){return Number(1!=n)}},es:{name:"Spanish",numbers:[1,2],plurals:function(n){return Number(1!=n)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(n){return Number(1!=n)}},et:{name:"Estonian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},eu:{name:"Basque",numbers:[1,2],plurals:function(n){return Number(1!=n)}},fa:{name:"Persian",numbers:[1],plurals:function(){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(n){return Number(1!=n)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(n){return Number(n>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(n){return Number(1!=n)}},fr:{name:"French",numbers:[1,2],plurals:function(n){return Number(n>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(n){return Number(1==n?0:2==n?1:7>n?2:11>n?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(n){return Number(1==n||11==n?0:2==n||12==n?1:n>2&&20>n?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(n){return Number(1!=n)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(n){return Number(1!=n)}},gun:{name:"Gun",numbers:[1,2],plurals:function(n){return Number(n>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(n){return Number(1!=n)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(n){return Number(1!=n)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(n){return Number(1!=n)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(n){return Number(1!=n)}},id:{name:"Indonesian",numbers:[1],plurals:function(){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(n){return Number(n%10!=1||n%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ja:{name:"Japanese",numbers:[1],plurals:function(){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(n){return Number(0!==n)}},ka:{name:"Georgian",numbers:[1],plurals:function(){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ko:{name:"Korean",numbers:[1],plurals:function(){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(n){return Number(1!=n)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(n){return Number(1==n?0:2==n?1:3==n?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(n){return Number(n>1)}},lo:{name:"Lao",numbers:[1],plurals:function(){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&(10>n%100||n%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[0,1,2],plurals:function(n){return Number(n%10==1&&n%100!=11?0:0!==n?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(n){return Number(1!=n)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(n){return Number(n>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(n){return Number(n>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(n){return Number(n>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(n){return Number(1==n||n%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(n){return Number(1!=n)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(n){return Number(1==n?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ms:{name:"Malay",numbers:[1],plurals:function(){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(n){return Number(1==n?0:0===n||n%100>1&&11>n%100?1:n%100>10&&20>n%100?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(n){return Number(1!=n)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(n){return Number(1!=n)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(n){return Number(1!=n)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(n){return Number(1!=n)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(n){return Number(1!=n)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(n){return Number(1!=n)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(n){return Number(n>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(n){return Number(1!=n)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(n){return Number(1!=n)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(n){return Number(1!=n)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(n){return Number(1==n?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(n){return Number(1!=n)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(n){return Number(1!=n)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(n){return Number(1!=n)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(n){return Number(1==n?0:0===n||n%100>0&&20>n%100?1:2)
}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(n){return Number(1!=n)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(n){return Number(1!=n)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(n){return Number(1!=n)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(n){return Number(1==n?0:n>=2&&4>=n?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(n){return Number(n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(n){return Number(1!=n)}},son:{name:"Songhay",numbers:[1,2],plurals:function(n){return Number(1!=n)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(n){return Number(1!=n)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(n){return Number(1!=n)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(n){return Number(1!=n)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(n){return Number(1!=n)}},te:{name:"Telugu",numbers:[1,2],plurals:function(n){return Number(1!=n)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(n){return Number(n>1)}},th:{name:"Thai",numbers:[1],plurals:function(){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(n){return Number(n>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(n){return Number(1!=n)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(n){return Number(n>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(n){return Number(n%10==1&&n%100!=11?0:n%10>=2&&4>=n%10&&(10>n%100||n%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(n){return Number(1!=n)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(n){return Number(n>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(n){return Number(n>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(n){return Number(1!=n)}},zh:{name:"Chinese",numbers:[1],plurals:function(){return 0}}},addRule:function(lng,obj){pluralExtensions.rules[lng]=obj},setCurrentLng:function(lng){if(!pluralExtensions.currentRule||pluralExtensions.currentRule.lng!==lng){var parts=lng.split("-");pluralExtensions.currentRule={lng:lng,rule:pluralExtensions.rules[parts[0]]}}},get:function(lng,count){function getResult(l,c){var ext;if(ext=pluralExtensions.currentRule&&pluralExtensions.currentRule.lng===lng?pluralExtensions.currentRule.rule:pluralExtensions.rules[l]){var i=ext.plurals(c),number=ext.numbers[i];return 2===ext.numbers.length&&1===ext.numbers[0]&&(2===number?number=-1:1===number&&(number=1)),number}return 1===c?"1":"-1"}var parts=lng.split("-");return getResult(parts[0],count)}},postProcessors={},addPostProcessor=function(name,fc){postProcessors[name]=fc},sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input);return output.join("")}var str_format=function(){return str_format.cache.hasOwnProperty(arguments[0])||(str_format.cache[arguments[0]]=str_format.parse(arguments[0])),str_format.format.call(null,str_format.cache[arguments[0]],arguments)};return str_format.format=function(parse_tree,argv){var arg,i,k,match,pad,pad_character,pad_length,cursor=1,tree_length=parse_tree.length,node_type="",output=[];for(i=0;tree_length>i;i++)if(node_type=get_type(parse_tree[i]),"string"===node_type)output.push(parse_tree[i]);else if("array"===node_type){if(match=parse_tree[i],match[2])for(arg=argv[cursor],k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw sprintf('[sprintf] property "%s" does not exist',match[2][k]);arg=arg[match[2][k]]}else arg=match[1]?argv[match[1]]:argv[cursor++];if(/[^s]/.test(match[8])&&"number"!=get_type(arg))throw sprintf("[sprintf] expecting number but found %s",get_type(arg));switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg,pad_character=match[4]?"0"==match[4]?"0":match[4].charAt(1):" ",pad_length=match[6]-String(arg).length,pad=match[6]?str_repeat(pad_character,pad_length):"",output.push(match[5]?arg+pad:pad+arg)}return output.join("")},str_format.cache={},str_format.parse=function(fmt){for(var _fmt=fmt,match=[],parse_tree=[],arg_names=0;_fmt;){if(null!==(match=/^[^\x25]+/.exec(_fmt)))parse_tree.push(match[0]);else if(null!==(match=/^\x25{2}/.exec(_fmt)))parse_tree.push("%");else{if(null===(match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)))throw"[sprintf] huh?";if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if(null===(field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field)))throw"[sprintf] huh?";for(field_list.push(field_match[1]);""!==(replacement_field=replacement_field.substring(field_match[0].length));)if(null!==(field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)))field_list.push(field_match[1]);else{if(null===(field_match=/^\[(\d+)\]/.exec(replacement_field)))throw"[sprintf] huh?";field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(3===arg_names)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return parse_tree},str_format}(),vsprintf=function(fmt,argv){return argv.unshift(fmt),sprintf.apply(null,argv)};addPostProcessor("sprintf",function(val,key,opts){return opts.sprintf?"[object Array]"===Object.prototype.toString.apply(opts.sprintf)?vsprintf(val,opts.sprintf):"object"==typeof opts.sprintf?sprintf(val,opts.sprintf):val:val}),i18n.init=init,i18n.setLng=setLng,i18n.preload=preload,i18n.addResourceBundle=addResourceBundle,i18n.loadNamespace=loadNamespace,i18n.loadNamespaces=loadNamespaces,i18n.setDefaultNamespace=setDefaultNamespace,i18n.t=translate,i18n.translate=translate,i18n.exists=exists,i18n.detectLanguage=f.detectLanguage,i18n.pluralExtensions=pluralExtensions,i18n.sync=sync,i18n.functions=f,i18n.lng=lng,i18n.addPostProcessor=addPostProcessor,i18n.options=o}();var PEG=function(){function peg$subclass(child,parent){function ctor(){this.constructor=child}ctor.prototype=parent.prototype,child.prototype=new ctor}function SyntaxError(expected,found,offset,line,column){function buildMessage(expected,found){function stringEscape(s){function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}return s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(ch){return"\\x"+hex(ch)}).replace(/[\u0180-\u0FFF]/g,function(ch){return"\\u0"+hex(ch)}).replace(/[\u1080-\uFFFF]/g,function(ch){return"\\u"+hex(ch)})}var expectedDesc,foundDesc;switch(expected.length){case 0:expectedDesc="end of input";break;case 1:expectedDesc=expected[0];break;default:expectedDesc=expected.slice(0,-1).join(", ")+" or "+expected[expected.length-1]}return foundDesc=found?'"'+stringEscape(found)+'"':"end of input","Expected "+expectedDesc+" but "+foundDesc+" found."}this.expected=expected,this.found=found,this.offset=offset,this.line=line,this.column=column,this.name="SyntaxError",this.message=buildMessage(expected,found)}function parse(input){function offset(){return peg$reportedPos}function line(){return peg$computePosDetails(peg$reportedPos).line}function column(){return peg$computePosDetails(peg$reportedPos).column}function peg$computePosDetails(pos){function advance(details,startPos,endPos){var p,ch;for(p=startPos;endPos>p;p++)ch=input.charAt(p),"\n"===ch?(details.seenCR||details.line++,details.column=1,details.seenCR=!1):"\r"===ch||"\u2028"===ch||"\u2029"===ch?(details.line++,details.column=1,details.seenCR=!0):(details.column++,details.seenCR=!1)}return peg$cachedPos!==pos&&(peg$cachedPos>pos&&(peg$cachedPos=0,peg$cachedPosDetails={line:1,column:1,seenCR:!1}),advance(peg$cachedPosDetails,peg$cachedPos,pos),peg$cachedPos=pos),peg$cachedPosDetails}function peg$fail(expected){peg$maxFailPos>peg$currPos||(peg$currPos>peg$maxFailPos&&(peg$maxFailPos=peg$currPos,peg$maxFailExpected=[]),peg$maxFailExpected.push(expected))}function peg$cleanupExpected(expected){var i=0;for(expected.sort();i<expected.length;)expected[i-1]===expected[i]?expected.splice(i,1):i++}function peg$parseStart(){var s0,s1,s2,s3,key=42*peg$currPos+0,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parse_(),null!==s1?(s2=peg$parseChapters(),null===s2&&(s2=peg$c2),null!==s2?(s3=peg$parse_(),null!==s3?(peg$reportedPos=s0,s1=peg$c3(s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c0)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseChapters(){var s0,s1,s2,key=42*peg$currPos+1,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseChapter(),null!==s1?(s2=peg$parseChapters(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c5(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c4)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseChapter(){var s0,s1,s2,key=42*peg$currPos+2,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseHeadline(),null!==s1?(s2=peg$parseContents(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c7(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c6)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseHeadline(){var s0,s1,s2,s3,s4,s5,s6,s7,key=42*peg$currPos+3,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=[],61===input.charCodeAt(peg$currPos)?(s2=peg$c10,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c11)),null!==s2)for(;null!==s2;)s1.push(s2),61===input.charCodeAt(peg$currPos)?(s2=peg$c10,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c11));else s1=peg$c1;if(null!==s1)if(s2=peg$parseBracketArg(),null===s2&&(s2=peg$c2),null!==s2)if(s3=peg$parseBraceArg(),null===s3&&(s3=peg$c2),null!==s3){for(s4=[],s5=peg$parseSpace();null!==s5;)s4.push(s5),s5=peg$parseSpace();if(null!==s4)if(s5=peg$parseSinglelineContent(),null!==s5){for(s6=[],s7=peg$parseNewline();null!==s7;)s6.push(s7),s7=peg$parseNewline();null!==s6?(peg$reportedPos=s0,s1=peg$c12(s1,s2,s3,s5),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1;else peg$currPos=s0,s0=peg$c1}else peg$currPos=s0,s0=peg$c1;else peg$currPos=s0,s0=peg$c1;else peg$currPos=s0,s0=peg$c1;return peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c8)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseContents(){var s0,s1,s2,s3,s4,key=42*peg$currPos+4,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,peg$silentFails++,input.length>peg$currPos?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c14)),peg$silentFails--,null!==s2?(peg$currPos=s1,s1=peg$c2):s1=peg$c1,null!==s1?(s2=peg$parseContent(),null!==s2?(s3=peg$parseContents(),null===s3&&(s3=peg$c2),null!==s3?(s4=peg$parseNewline(),null===s4&&(s4=peg$c2),null!==s4?(peg$reportedPos=s0,s1=peg$c15(s2,s3),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c13)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseContent(){var s0,s1,key=42*peg$currPos+5,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseSinglelineComment(),null!==s1&&(peg$reportedPos=s0,s1=peg$c17(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseBlockElement(),null!==s1&&(peg$reportedPos=s0,s1=peg$c17(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseUlist(),null!==s1&&(peg$reportedPos=s0,s1=peg$c17(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseOlist(),null!==s1&&(peg$reportedPos=s0,s1=peg$c17(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseDlist(),null!==s1&&(peg$reportedPos=s0,s1=peg$c17(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseParagraph(),null!==s1&&(peg$reportedPos=s0,s1=peg$c17(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1))))),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c16)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseParagraph(){var s0,s1,s2,s3,key=42*peg$currPos+6,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,peg$silentFails++,61===input.charCodeAt(peg$currPos)?(s2=peg$c10,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c11)),peg$silentFails--,null===s2?s1=peg$c2:(peg$currPos=s1,s1=peg$c1),null!==s1?(s2=peg$parseParagraphSubs(),null!==s2?(s3=peg$parse_(),null!==s3?(peg$reportedPos=s0,s1=peg$c19(s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c18)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseParagraphSubs(){var s0,s1,s2,key=42*peg$currPos+7,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseParagraphSub(),null!==s1?(s2=peg$parseParagraphSubs(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c21(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c20)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseParagraphSub(){var s0,s1,key=42*peg$currPos+8,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseInlineElement(),null!==s1&&(peg$reportedPos=s0,s1=peg$c23(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseContentText(),null!==s1&&(peg$reportedPos=s0,s1=peg$c23(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c22)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseContentText(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13,key=42*peg$currPos+9,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,s2=peg$currPos,s3=peg$currPos,peg$silentFails++,s4=peg$parseNewline(),peg$silentFails--,null===s4?s3=peg$c2:(peg$currPos=s3,s3=peg$c1),null!==s3)if(s4=peg$currPos,peg$silentFails++,s5=peg$parseHeadline(),peg$silentFails--,null===s5?s4=peg$c2:(peg$currPos=s4,s4=peg$c1),null!==s4)if(s5=peg$currPos,peg$silentFails++,s6=peg$parseSinglelineComment(),peg$silentFails--,null===s6?s5=peg$c2:(peg$currPos=s5,s5=peg$c1),null!==s5)if(s6=peg$currPos,peg$silentFails++,s7=peg$parseBlockElement(),peg$silentFails--,null===s7?s6=peg$c2:(peg$currPos=s6,s6=peg$c1),null!==s6)if(s7=peg$currPos,peg$silentFails++,s8=peg$parseUlist(),peg$silentFails--,null===s8?s7=peg$c2:(peg$currPos=s7,s7=peg$c1),null!==s7)if(s8=peg$currPos,peg$silentFails++,s9=peg$parseOlist(),peg$silentFails--,null===s9?s8=peg$c2:(peg$currPos=s8,s8=peg$c1),null!==s8)if(s9=peg$currPos,peg$silentFails++,s10=peg$parseDlist(),peg$silentFails--,null===s10?s9=peg$c2:(peg$currPos=s9,s9=peg$c1),null!==s9){if(s10=[],s11=peg$currPos,s12=peg$currPos,peg$silentFails++,s13=peg$parseInlineElement(),peg$silentFails--,null===s13?s12=peg$c2:(peg$currPos=s12,s12=peg$c1),null!==s12?(peg$c25.test(input.charAt(peg$currPos))?(s13=input.charAt(peg$currPos),peg$currPos++):(s13=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s13?(s12=[s12,s13],s11=s12):(peg$currPos=s11,s11=peg$c1)):(peg$currPos=s11,s11=peg$c1),null!==s11)for(;null!==s11;)s10.push(s11),s11=peg$currPos,s12=peg$currPos,peg$silentFails++,s13=peg$parseInlineElement(),peg$silentFails--,null===s13?s12=peg$c2:(peg$currPos=s12,s12=peg$c1),null!==s12?(peg$c25.test(input.charAt(peg$currPos))?(s13=input.charAt(peg$currPos),peg$currPos++):(s13=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s13?(s12=[s12,s13],s11=s12):(peg$currPos=s11,s11=peg$c1)):(peg$currPos=s11,s11=peg$c1);else s10=peg$c1;null!==s10?(s11=peg$parseNewline(),null===s11&&(s11=peg$c2),null!==s11?(s12=peg$parseContentText(),null===s12&&(s12=peg$c2),null!==s12?(s3=[s3,s4,s5,s6,s7,s8,s9,s10,s11,s12],s2=s3):(peg$currPos=s2,s2=peg$c1)):(peg$currPos=s2,s2=peg$c1)):(peg$currPos=s2,s2=peg$c1)}else peg$currPos=s2,s2=peg$c1;else peg$currPos=s2,s2=peg$c1;else peg$currPos=s2,s2=peg$c1;else peg$currPos=s2,s2=peg$c1;else peg$currPos=s2,s2=peg$c1;else peg$currPos=s2,s2=peg$c1;else peg$currPos=s2,s2=peg$c1;return null!==s2&&(s2=input.substring(s1,peg$currPos)),s1=s2,null!==s1&&(peg$reportedPos=s0,s1=peg$c27(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c24)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseBlockElement(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,key=42*peg$currPos+10,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,input.substr(peg$currPos,2)===peg$c29?(s1=peg$c29,peg$currPos+=2):(s1=null,0===peg$silentFails&&peg$fail(peg$c30)),null!==s1){if(s2=peg$currPos,s3=[],s4=peg$parseAZ(),null!==s4)for(;null!==s4;)s3.push(s4),s4=peg$parseAZ();else s3=peg$c1;if(null!==s3&&(s3=input.substring(s2,peg$currPos)),s2=s3,null!==s2){for(s3=[],s4=peg$parseBracketArg();null!==s4;)s3.push(s4),s4=peg$parseBracketArg();null!==s3?(123===input.charCodeAt(peg$currPos)?(s4=peg$c31,peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c32)),null!==s4?(s5=peg$parseNewline(),null!==s5?(s6=peg$parseBlockElementContents(),null===s6&&(s6=peg$c2),null!==s6?(input.substr(peg$currPos,3)===peg$c33?(s7=peg$c33,peg$currPos+=3):(s7=null,0===peg$silentFails&&peg$fail(peg$c34)),null!==s7?(s8=peg$parse_(),null!==s8?(peg$reportedPos=s0,s1=peg$c35(s2,s3,s6),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1}else peg$currPos=s0,s0=peg$c1;if(null===s0)if(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c29?(s1=peg$c29,peg$currPos+=2):(s1=null,0===peg$silentFails&&peg$fail(peg$c30)),null!==s1){if(s2=peg$currPos,s3=[],s4=peg$parseAZ(),null!==s4)for(;null!==s4;)s3.push(s4),s4=peg$parseAZ();else s3=peg$c1;if(null!==s3&&(s3=input.substring(s2,peg$currPos)),s2=s3,null!==s2){for(s3=[],s4=peg$parseBracketArg();null!==s4;)s3.push(s4),s4=peg$parseBracketArg();null!==s3?(s4=peg$parse_(),null!==s4?(peg$reportedPos=s0,s1=peg$c36(s2,s3),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1}else peg$currPos=s0,s0=peg$c1;return peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c28)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseInlineElement(){var s0,s1,s2,s3,s4,s5,s6,key=42*peg$currPos+11,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,input.substr(peg$currPos,2)===peg$c38?(s1=peg$c38,peg$currPos+=2):(s1=null,0===peg$silentFails&&peg$fail(peg$c39)),null!==s1){if(s2=peg$currPos,s3=[],peg$c40.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c41)),null!==s4)for(;null!==s4;)s3.push(s4),peg$c40.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c41));else s3=peg$c1;null!==s3&&(s3=input.substring(s2,peg$currPos)),s2=s3,null!==s2?(62===input.charCodeAt(peg$currPos)?(s3=peg$c42,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c43)),null!==s3?(123===input.charCodeAt(peg$currPos)?(s4=peg$c31,peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c32)),null!==s4?(s5=peg$parseInlineElementContents(),null===s5&&(s5=peg$c2),null!==s5?(125===input.charCodeAt(peg$currPos)?(s6=peg$c44,peg$currPos++):(s6=null,0===peg$silentFails&&peg$fail(peg$c45)),null!==s6?(peg$reportedPos=s0,s1=peg$c46(s2,s5),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1;return peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c37)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseBracketArg(){var s0,s1,s2,s3,s4,key=42*peg$currPos+12,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,91===input.charCodeAt(peg$currPos)?(s1=peg$c48,peg$currPos++):(s1=null,0===peg$silentFails&&peg$fail(peg$c49)),null!==s1){for(s2=peg$currPos,s3=[],peg$c50.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c51));null!==s4;)s3.push(s4),peg$c50.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c51));null!==s3&&(s3=input.substring(s2,peg$currPos)),s2=s3,null!==s2?(93===input.charCodeAt(peg$currPos)?(s3=peg$c52,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c53)),null!==s3?(peg$reportedPos=s0,s1=peg$c54(s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1;return peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c47)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseBraceArg(){var s0,s1,s2,s3,s4,key=42*peg$currPos+13,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,123===input.charCodeAt(peg$currPos)?(s1=peg$c31,peg$currPos++):(s1=null,0===peg$silentFails&&peg$fail(peg$c32)),null!==s1){for(s2=peg$currPos,s3=[],peg$c56.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c57));null!==s4;)s3.push(s4),peg$c56.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=null,0===peg$silentFails&&peg$fail(peg$c57));null!==s3&&(s3=input.substring(s2,peg$currPos)),s2=s3,null!==s2?(125===input.charCodeAt(peg$currPos)?(s3=peg$c44,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c45)),null!==s3?(peg$reportedPos=s0,s1=peg$c58(s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1;return peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c55)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseBlockElementContents(){var s0,s1,s2,s3,key=42*peg$currPos+14,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseBlockElementContent(),null!==s1?(s2=peg$parseBlockElementContents(),null===s2&&(s2=peg$c2),null!==s2?(s3=peg$parse_(),null!==s3?(peg$reportedPos=s0,s1=peg$c60(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c59)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseBlockElementContent(){var s0,s1,key=42*peg$currPos+15,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseSinglelineComment(),null!==s1&&(peg$reportedPos=s0,s1=peg$c62(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseBlockElement(),null!==s1&&(peg$reportedPos=s0,s1=peg$c62(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseUlist(),null!==s1&&(peg$reportedPos=s0,s1=peg$c62(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseOlist(),null!==s1&&(peg$reportedPos=s0,s1=peg$c62(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseDlist(),null!==s1&&(peg$reportedPos=s0,s1=peg$c62(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseBlockElementParagraph(),null!==s1&&(peg$reportedPos=s0,s1=peg$c62(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1))))),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c61)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseBlockElementParagraph(){var s0,s1,s2,key=42*peg$currPos+16,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseBlockElementParagraphSubs(),null!==s1?(s2=peg$parse_(),null!==s2?(peg$reportedPos=s0,s1=peg$c19(s1),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c63)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseBlockElementParagraphSubs(){var s0,s1,s2,key=42*peg$currPos+17,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseBlockElementParagraphSub(),null!==s1?(s2=peg$parseBlockElementParagraphSubs(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c21(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c64)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseBlockElementParagraphSub(){var s0,s1,key=42*peg$currPos+18,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseInlineElement(),null!==s1&&(peg$reportedPos=s0,s1=peg$c23(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseBlockElementContentText(),null!==s1&&(peg$reportedPos=s0,s1=peg$c23(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c65)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseBlockElementContentText(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13,s14,s15,key=42*peg$currPos+19,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,s2=[],s3=peg$currPos,s4=peg$currPos,peg$silentFails++,input.length>peg$currPos?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=null,0===peg$silentFails&&peg$fail(peg$c14)),peg$silentFails--,null!==s5?(peg$currPos=s4,s4=peg$c2):s4=peg$c1,null!==s4)if(s5=peg$currPos,peg$silentFails++,input.substr(peg$currPos,3)===peg$c33?(s6=peg$c33,peg$currPos+=3):(s6=null,0===peg$silentFails&&peg$fail(peg$c34)),peg$silentFails--,null===s6?s5=peg$c2:(peg$currPos=s5,s5=peg$c1),null!==s5)if(s6=peg$currPos,peg$silentFails++,s7=peg$parseSinglelineComment(),peg$silentFails--,null===s7?s6=peg$c2:(peg$currPos=s6,s6=peg$c1),null!==s6)if(s7=peg$currPos,peg$silentFails++,s8=peg$parseBlockElement(),peg$silentFails--,null===s8?s7=peg$c2:(peg$currPos=s7,s7=peg$c1),null!==s7)if(s8=peg$currPos,peg$silentFails++,s9=peg$parseInlineElement(),peg$silentFails--,null===s9?s8=peg$c2:(peg$currPos=s8,s8=peg$c1),null!==s8)if(s9=peg$currPos,peg$silentFails++,s10=peg$parseUlist(),peg$silentFails--,null===s10?s9=peg$c2:(peg$currPos=s9,s9=peg$c1),null!==s9)if(s10=peg$currPos,peg$silentFails++,s11=peg$parseOlist(),peg$silentFails--,null===s11?s10=peg$c2:(peg$currPos=s10,s10=peg$c1),null!==s10)if(s11=peg$currPos,peg$silentFails++,s12=peg$parseDlist(),peg$silentFails--,null===s12?s11=peg$c2:(peg$currPos=s11,s11=peg$c1),null!==s11){if(s12=[],s13=peg$currPos,s14=peg$currPos,peg$silentFails++,s15=peg$parseInlineElement(),peg$silentFails--,null===s15?s14=peg$c2:(peg$currPos=s14,s14=peg$c1),null!==s14?(peg$c25.test(input.charAt(peg$currPos))?(s15=input.charAt(peg$currPos),peg$currPos++):(s15=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s15?(s14=[s14,s15],s13=s14):(peg$currPos=s13,s13=peg$c1)):(peg$currPos=s13,s13=peg$c1),null!==s13)for(;null!==s13;)s12.push(s13),s13=peg$currPos,s14=peg$currPos,peg$silentFails++,s15=peg$parseInlineElement(),peg$silentFails--,null===s15?s14=peg$c2:(peg$currPos=s14,s14=peg$c1),null!==s14?(peg$c25.test(input.charAt(peg$currPos))?(s15=input.charAt(peg$currPos),peg$currPos++):(s15=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s15?(s14=[s14,s15],s13=s14):(peg$currPos=s13,s13=peg$c1)):(peg$currPos=s13,s13=peg$c1);else s12=peg$c1;null!==s12?(s13=peg$parseNewline(),null===s13&&(s13=peg$c2),null!==s13?(s4=[s4,s5,s6,s7,s8,s9,s10,s11,s12,s13],s3=s4):(peg$currPos=s3,s3=peg$c1)):(peg$currPos=s3,s3=peg$c1)}else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;if(null!==s3)for(;null!==s3;)if(s2.push(s3),s3=peg$currPos,s4=peg$currPos,peg$silentFails++,input.length>peg$currPos?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=null,0===peg$silentFails&&peg$fail(peg$c14)),peg$silentFails--,null!==s5?(peg$currPos=s4,s4=peg$c2):s4=peg$c1,null!==s4)if(s5=peg$currPos,peg$silentFails++,input.substr(peg$currPos,3)===peg$c33?(s6=peg$c33,peg$currPos+=3):(s6=null,0===peg$silentFails&&peg$fail(peg$c34)),peg$silentFails--,null===s6?s5=peg$c2:(peg$currPos=s5,s5=peg$c1),null!==s5)if(s6=peg$currPos,peg$silentFails++,s7=peg$parseSinglelineComment(),peg$silentFails--,null===s7?s6=peg$c2:(peg$currPos=s6,s6=peg$c1),null!==s6)if(s7=peg$currPos,peg$silentFails++,s8=peg$parseBlockElement(),peg$silentFails--,null===s8?s7=peg$c2:(peg$currPos=s7,s7=peg$c1),null!==s7)if(s8=peg$currPos,peg$silentFails++,s9=peg$parseInlineElement(),peg$silentFails--,null===s9?s8=peg$c2:(peg$currPos=s8,s8=peg$c1),null!==s8)if(s9=peg$currPos,peg$silentFails++,s10=peg$parseUlist(),peg$silentFails--,null===s10?s9=peg$c2:(peg$currPos=s9,s9=peg$c1),null!==s9)if(s10=peg$currPos,peg$silentFails++,s11=peg$parseOlist(),peg$silentFails--,null===s11?s10=peg$c2:(peg$currPos=s10,s10=peg$c1),null!==s10)if(s11=peg$currPos,peg$silentFails++,s12=peg$parseDlist(),peg$silentFails--,null===s12?s11=peg$c2:(peg$currPos=s11,s11=peg$c1),null!==s11){if(s12=[],s13=peg$currPos,s14=peg$currPos,peg$silentFails++,s15=peg$parseInlineElement(),peg$silentFails--,null===s15?s14=peg$c2:(peg$currPos=s14,s14=peg$c1),null!==s14?(peg$c25.test(input.charAt(peg$currPos))?(s15=input.charAt(peg$currPos),peg$currPos++):(s15=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s15?(s14=[s14,s15],s13=s14):(peg$currPos=s13,s13=peg$c1)):(peg$currPos=s13,s13=peg$c1),null!==s13)for(;null!==s13;)s12.push(s13),s13=peg$currPos,s14=peg$currPos,peg$silentFails++,s15=peg$parseInlineElement(),peg$silentFails--,null===s15?s14=peg$c2:(peg$currPos=s14,s14=peg$c1),null!==s14?(peg$c25.test(input.charAt(peg$currPos))?(s15=input.charAt(peg$currPos),peg$currPos++):(s15=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s15?(s14=[s14,s15],s13=s14):(peg$currPos=s13,s13=peg$c1)):(peg$currPos=s13,s13=peg$c1);
else s12=peg$c1;null!==s12?(s13=peg$parseNewline(),null===s13&&(s13=peg$c2),null!==s13?(s4=[s4,s5,s6,s7,s8,s9,s10,s11,s12,s13],s3=s4):(peg$currPos=s3,s3=peg$c1)):(peg$currPos=s3,s3=peg$c1)}else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else peg$currPos=s3,s3=peg$c1;else s2=peg$c1;return null!==s2&&(s2=input.substring(s1,peg$currPos)),s1=s2,null!==s1&&(peg$reportedPos=s0,s1=peg$c27(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c66)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseInlineElementContents(){var s0,s1,s2,s3,key=42*peg$currPos+20,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,peg$silentFails++,125===input.charCodeAt(peg$currPos)?(s2=peg$c44,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c45)),peg$silentFails--,null===s2?s1=peg$c2:(peg$currPos=s1,s1=peg$c1),null!==s1?(s2=peg$parseInlineElementContent(),null!==s2?(s3=peg$parseInlineElementContents(),null===s3&&(s3=peg$c2),null!==s3?(peg$reportedPos=s0,s1=peg$c68(s2,s3),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c67)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseInlineElementContent(){var s0,s1,key=42*peg$currPos+21,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseInlineElement(),null!==s1&&(peg$reportedPos=s0,s1=peg$c70(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseInlineElementContentText(),null!==s1&&(peg$reportedPos=s0,s1=peg$c70(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c69)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseInlineElementContentText(){var s0,s1,s2,s3,s4,s5,key=42*peg$currPos+22,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,s2=[],s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseInlineElement(),peg$silentFails--,null===s5?s4=peg$c2:(peg$currPos=s4,s4=peg$c1),null!==s4?(peg$c72.test(input.charAt(peg$currPos))?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=null,0===peg$silentFails&&peg$fail(peg$c73)),null!==s5?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$c1)):(peg$currPos=s3,s3=peg$c1),null!==s3)for(;null!==s3;)s2.push(s3),s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseInlineElement(),peg$silentFails--,null===s5?s4=peg$c2:(peg$currPos=s4,s4=peg$c1),null!==s4?(peg$c72.test(input.charAt(peg$currPos))?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=null,0===peg$silentFails&&peg$fail(peg$c73)),null!==s5?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$c1)):(peg$currPos=s3,s3=peg$c1);else s2=peg$c1;return null!==s2&&(s2=input.substring(s1,peg$currPos)),s1=s2,null!==s1&&(peg$reportedPos=s0,s1=peg$c74(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c71)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseSinglelineContent(){var s0,s1,s2,key=42*peg$currPos+23,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseContentInlines(),null!==s1?(s2=peg$parseNewline(),null===s2&&(s2=peg$parseEOF()),null!==s2?(peg$reportedPos=s0,s1=peg$c76(s1),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c75)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseContentInlines(){var s0,s1,s2,key=42*peg$currPos+24,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseContentInline(),null!==s1?(s2=peg$parseContentInlines(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c78(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c77)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseContentInline(){var s0,s1,key=42*peg$currPos+25,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseInlineElement(),null!==s1&&(peg$reportedPos=s0,s1=peg$c80(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,null===s0&&(s0=peg$currPos,s1=peg$parseContentInlineText(),null!==s1&&(peg$reportedPos=s0,s1=peg$c80(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c79)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseContentInlineText(){var s0,s1,s2,s3,s4,s5,key=42*peg$currPos+26,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,s2=[],s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseInlineElement(),peg$silentFails--,null===s5?s4=peg$c2:(peg$currPos=s4,s4=peg$c1),null!==s4?(peg$c25.test(input.charAt(peg$currPos))?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s5?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$c1)):(peg$currPos=s3,s3=peg$c1),null!==s3)for(;null!==s3;)s2.push(s3),s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseInlineElement(),peg$silentFails--,null===s5?s4=peg$c2:(peg$currPos=s4,s4=peg$c1),null!==s4?(peg$c25.test(input.charAt(peg$currPos))?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=null,0===peg$silentFails&&peg$fail(peg$c26)),null!==s5?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$c1)):(peg$currPos=s3,s3=peg$c1);else s2=peg$c1;return null!==s2&&(s2=input.substring(s1,peg$currPos)),s1=s2,null!==s1&&(peg$reportedPos=s0,s1=peg$c82(s1)),null===s1?(peg$currPos=s0,s0=s1):s0=s1,peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c81)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseUlist(){var s0,s1,s2,key=42*peg$currPos+27,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseUlistElement(),null===s1&&(s1=peg$parseSinglelineComment()),null!==s1?(s2=peg$parseUlist(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c84(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c83)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseUlistElement(){var s0,s1,s2,s3,s4,key=42*peg$currPos+28,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=[],32===input.charCodeAt(peg$currPos)?(s2=peg$c86,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c87)),null!==s2)for(;null!==s2;)s1.push(s2),32===input.charCodeAt(peg$currPos)?(s2=peg$c86,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c87));else s1=peg$c1;if(null!==s1){if(s2=[],42===input.charCodeAt(peg$currPos)?(s3=peg$c88,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c89)),null!==s3)for(;null!==s3;)s2.push(s3),42===input.charCodeAt(peg$currPos)?(s3=peg$c88,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c89));else s2=peg$c1;null!==s2?(s3=peg$parse_(),null!==s3?(s4=peg$parseSinglelineContent(),null!==s4?(peg$reportedPos=s0,s1=peg$c90(s2,s4),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)}else peg$currPos=s0,s0=peg$c1;return peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c85)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseOlist(){var s0,s1,s2,key=42*peg$currPos+29,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseOlistElement(),null===s1&&(s1=peg$parseSinglelineComment()),null!==s1?(s2=peg$parseOlist(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c92(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c91)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseOlistElement(){var s0,s1,s2,s3,s4,s5,key=42*peg$currPos+30,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=[],32===input.charCodeAt(peg$currPos)?(s2=peg$c86,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c87)),null!==s2)for(;null!==s2;)s1.push(s2),32===input.charCodeAt(peg$currPos)?(s2=peg$c86,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c87));else s1=peg$c1;return null!==s1?(s2=peg$parseDigits(),null!==s2?(46===input.charCodeAt(peg$currPos)?(s3=peg$c94,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c95)),null!==s3?(s4=peg$parse_(),null!==s4?(s5=peg$parseSinglelineContent(),null!==s5?(peg$reportedPos=s0,s1=peg$c96(s2,s5),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c93)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseDlist(){var s0,s1,s2,key=42*peg$currPos+31,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,s1=peg$parseDlistElement(),null===s1&&(s1=peg$parseSinglelineComment()),null!==s1?(s2=peg$parseDlist(),null===s2&&(s2=peg$c2),null!==s2?(peg$reportedPos=s0,s1=peg$c98(s1,s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c97)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseDlistElement(){var s0,s1,s2,s3,s4,s5,s6,s7,key=42*peg$currPos+32,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;for(peg$silentFails++,s0=peg$currPos,s1=[],32===input.charCodeAt(peg$currPos)?(s2=peg$c86,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c87));null!==s2;)s1.push(s2),32===input.charCodeAt(peg$currPos)?(s2=peg$c86,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c87));return null!==s1?(58===input.charCodeAt(peg$currPos)?(s2=peg$c100,peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c101)),null!==s2?(32===input.charCodeAt(peg$currPos)?(s3=peg$c86,peg$currPos++):(s3=null,0===peg$silentFails&&peg$fail(peg$c87)),null!==s3?(s4=peg$parse_(),null!==s4?(s5=peg$parseSinglelineContent(),null!==s5?(s6=peg$parseDlistElementContent(),null!==s6?(s7=peg$parse_(),null!==s7?(peg$reportedPos=s0,s1=peg$c102(s5,s6),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c99)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseDlistElementContent(){var s0,s1,s2,key=42*peg$currPos+33,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=[],peg$c104.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c105)),null!==s2)for(;null!==s2;)s1.push(s2),peg$c104.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=null,0===peg$silentFails&&peg$fail(peg$c105));else s1=peg$c1;return null!==s1?(s2=peg$parseSinglelineContent(),null!==s2?(peg$reportedPos=s0,s1=peg$c106(s2),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c103)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseSinglelineComment(){var s0,s1,s2,s3,s4,s5,s6,key=42*peg$currPos+34,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=peg$currPos,s2=peg$currPos,input.substr(peg$currPos,2)===peg$c108?(s3=peg$c108,peg$currPos+=2):(s3=null,0===peg$silentFails&&peg$fail(peg$c109)),null!==s3){for(s4=peg$currPos,s5=[],peg$c25.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=null,0===peg$silentFails&&peg$fail(peg$c26));null!==s6;)s5.push(s6),peg$c25.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=null,0===peg$silentFails&&peg$fail(peg$c26));null!==s5&&(s5=input.substring(s4,peg$currPos)),s4=s5,null!==s4?(s5=peg$parseNewline(),null===s5&&(s5=peg$c2),null!==s5?(s3=[s3,s4,s5],s2=s3):(peg$currPos=s2,s2=peg$c1)):(peg$currPos=s2,s2=peg$c1)}else peg$currPos=s2,s2=peg$c1;return null!==s2&&(s2=input.substring(s1,peg$currPos)),s1=s2,null!==s1?(s2=peg$parse_(),null!==s2?(peg$reportedPos=s0,s1=peg$c110(s1),null===s1?(peg$currPos=s0,s0=s1):s0=s1):(peg$currPos=s0,s0=peg$c1)):(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c107)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseDigits(){var s0,s1,s2,key=42*peg$currPos+35,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;if(peg$silentFails++,s0=peg$currPos,s1=[],s2=peg$parseDigit(),null!==s2)for(;null!==s2;)s1.push(s2),s2=peg$parseDigit();else s1=peg$c1;return null!==s1&&(s1=input.substring(s0,peg$currPos)),s0=s1,peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c111)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseDigit(){var s0,s1,key=42*peg$currPos+36,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,peg$c113.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=null,0===peg$silentFails&&peg$fail(peg$c114)),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c112)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseAZ(){var s0,s1,key=42*peg$currPos+37,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,peg$c116.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=null,0===peg$silentFails&&peg$fail(peg$c117)),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c115)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseNewline(){var s0,s1,key=42*peg$currPos+38,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,input.substr(peg$currPos,2)===peg$c119?(s0=peg$c119,peg$currPos+=2):(s0=null,0===peg$silentFails&&peg$fail(peg$c120)),null===s0&&(10===input.charCodeAt(peg$currPos)?(s0=peg$c121,peg$currPos++):(s0=null,0===peg$silentFails&&peg$fail(peg$c122))),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c118)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parse_(){var s0,s1,s2,key=42*peg$currPos+39,cached=peg$cache[key];if(cached)return peg$currPos=cached.nextPos,cached.result;for(peg$silentFails++,s0=peg$currPos,s1=[],s2=peg$parseSpace();null!==s2;)s1.push(s2),s2=peg$parseSpace();return null!==s1&&(s1=input.substring(s0,peg$currPos)),s0=s1,peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c123)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0}function peg$parseSpace(){var s0,s1,key=42*peg$currPos+40,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,peg$c125.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=null,0===peg$silentFails&&peg$fail(peg$c126)),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c124)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}function peg$parseEOF(){var s0,s1,key=42*peg$currPos+41,cached=peg$cache[key];return cached?(peg$currPos=cached.nextPos,cached.result):(peg$silentFails++,s0=peg$currPos,peg$silentFails++,input.length>peg$currPos?(s1=input.charAt(peg$currPos),peg$currPos++):(s1=null,0===peg$silentFails&&peg$fail(peg$c14)),peg$silentFails--,null===s1?s0=peg$c2:(peg$currPos=s0,s0=peg$c1),peg$silentFails--,null===s0&&(s1=null,0===peg$silentFails&&peg$fail(peg$c127)),peg$cache[key]={nextPos:peg$currPos,result:s0},s0)}var peg$result,options=arguments.length>1?arguments[1]:{},peg$startRuleFunctions={Start:peg$parseStart},peg$startRuleFunction=peg$parseStart,peg$c0="start",peg$c1=null,peg$c2="",peg$c3=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Start",content:c}},peg$c4="chapters",peg$c5=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Chapters",content:processed}},peg$c6="chapter",peg$c7=function(headline,text){return{syntax:"Chapter",line:line(),column:column(),offset:offset(),endPos:peg$currPos,headline:headline,text:text}},peg$c8="headline",peg$c10="=",peg$c11='"="',peg$c12=function(level,cmd,label,caption){return{syntax:"Headline",line:line(),column:column(),offset:offset(),endPos:peg$currPos,level:level.length,cmd:cmd,label:label,caption:caption}},peg$c13="contents",peg$c14="any character",peg$c15=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Contents",content:processed}},peg$c16="content",peg$c17=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Content",content:c}},peg$c18="paragraph",peg$c19=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Paragraph",content:c}},peg$c20="paragraph subs",peg$c21=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"ParagraphSubs",content:processed}},peg$c22="paragraph sub",peg$c23=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"ParagraphSub",content:c}},peg$c24="text of content",peg$c25=/^[^\r\n]/,peg$c26="[^\\r\\n]",peg$c27=function(text){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"ContentText",text:text}},peg$c28="block element",peg$c29="//",peg$c30='"//"',peg$c31="{",peg$c32='"{"',peg$c33="//}",peg$c34='"//}"',peg$c35=function(symbol,args,contents){return{syntax:"BlockElement",line:line(),column:column(),offset:offset(),endPos:peg$currPos,symbol:symbol,args:args,content:contents}},peg$c36=function(symbol,args){return{syntax:"BlockElement",line:line(),column:column(),offset:offset(),endPos:peg$currPos,symbol:symbol,args:args,content:[]}},peg$c37="inline element",peg$c38="@<",peg$c39='"@<"',peg$c40=/^[^>\r\n]/,peg$c41="[^>\\r\\n]",peg$c42=">",peg$c43='">"',peg$c44="}",peg$c45='"}"',peg$c46=function(symbol,contents){return{syntax:"InlineElement",line:line(),column:column(),offset:offset(),endPos:peg$currPos,symbol:symbol,content:contents}},peg$c47="bracket argument",peg$c48="[",peg$c49='"["',peg$c50=/^[^\n\]]/,peg$c51="[^\\n\\]]",peg$c52="]",peg$c53='"]"',peg$c54=function(arg){return{syntax:"BracketArg",line:line(),column:column(),offset:offset(),endPos:peg$currPos,arg:arg}},peg$c55="brace argument",peg$c56=/^[^\n}]/,peg$c57="[^\\n}]",peg$c58=function(arg){return{syntax:"BraceArg",line:line(),column:column(),offset:offset(),endPos:peg$currPos,arg:arg}},peg$c59="contents of block element",peg$c60=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"BlockElementContents",content:processed}},peg$c61="content of block element",peg$c62=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"BlockElementContent",content:c}},peg$c63="paragraph in block",peg$c64="paragraph subs in block",peg$c65="paragraph sub in block",peg$c66="text of content in block",peg$c67="contents of inline element",peg$c68=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"InlineElementContents",content:processed}},peg$c69="content of inline element",peg$c70=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"InlineElementContent",content:c}},peg$c71="text of inline element",peg$c72=/^[^\r\n}]/,peg$c73="[^\\r\\n}]",peg$c74=function(text){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"InlineElementContentText",text:text}},peg$c75="inline content",peg$c76=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"SinglelineContent",content:c}},peg$c77="children of inline content",peg$c78=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"ContentInlines",content:processed}},peg$c79="child of inline content",peg$c80=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"ContentInline",content:c}},peg$c81="text of child of inline content",peg$c82=function(text){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"ContentInlineText",text:text}},peg$c83="ulist",peg$c84=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Ulist",content:processed}},peg$c85="ulist element",peg$c86=" ",peg$c87='" "',peg$c88="*",peg$c89='"*"',peg$c90=function(level,text){return{syntax:"UlistElement",line:line(),column:column(),offset:offset(),endPos:peg$currPos,level:level.length,text:text}},peg$c91="olist",peg$c92=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Olist",content:processed}},peg$c93="olist element",peg$c94=".",peg$c95='"."',peg$c96=function(n,text){return{syntax:"OlistElement",line:line(),column:column(),offset:offset(),endPos:peg$currPos,no:parseInt(n),text:text}},peg$c97="dlist",peg$c98=function(c,cc){var processed=[c];return""!==cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){processed.push(c)}):processed.push(cc.content)),{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"Dlist",content:processed}},peg$c99="dlist element",peg$c100=":",peg$c101='":"',peg$c102=function(text,content){return{syntax:"DlistElement",line:line(),column:column(),offset:offset(),endPos:peg$currPos,text:text,content:content}},peg$c103="content of dlist element",peg$c104=/^[ \t]/,peg$c105="[ \\t]",peg$c106=function(c){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"DlistElementContent",content:c}},peg$c107="signle line comment",peg$c108="#@",peg$c109='"#@"',peg$c110=function(text){return{line:line(),column:column(),offset:offset(),endPos:peg$currPos,syntax:"SinglelineComment",text:text}},peg$c111="digits",peg$c112="digit",peg$c113=/^[0-9]/,peg$c114="[0-9]",peg$c115="lower alphabet",peg$c116=/^[a-z]/,peg$c117="[a-z]",peg$c118="newline",peg$c119="\r\n",peg$c120='"\\r\\n"',peg$c121="\n",peg$c122='"\\n"',peg$c123="spacer",peg$c124="space",peg$c125=/^[ \t\r\n]/,peg$c126="[ \\t\\r\\n]",peg$c127="end of file",peg$currPos=0,peg$reportedPos=0,peg$cachedPos=0,peg$cachedPosDetails={line:1,column:1,seenCR:!1},peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0,peg$cache={};if("startRule"in options){if(!(options.startRule in peg$startRuleFunctions))throw new Error("Can't start parsing from rule \""+options.startRule+'".');peg$startRuleFunction=peg$startRuleFunctions[options.startRule]}if(peg$result=peg$startRuleFunction(),null!==peg$result&&peg$currPos===input.length)return peg$result;throw peg$cleanupExpected(peg$maxFailExpected),peg$reportedPos=Math.max(peg$currPos,peg$maxFailPos),new SyntaxError(peg$maxFailExpected,peg$reportedPos<input.length?input.charAt(peg$reportedPos):null,peg$reportedPos,peg$computePosDetails(peg$reportedPos).line,peg$computePosDetails(peg$reportedPos).column)}return peg$subclass(SyntaxError,Error),{SyntaxError:SyntaxError,parse:parse}}();!function(ReVIEW){!function(Build){var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},AnalyzerError=function(_super){function AnalyzerError(message){_super.call(this,message),this.name="AnalyzerError",this.message=message,Error.captureStackTrace&&Error.captureStackTrace(this,AnalyzerError)}return __extends(AnalyzerError,_super),AnalyzerError}(Error);Build.AnalyzerError=AnalyzerError}(ReVIEW.Build||(ReVIEW.Build={}))}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){function isNodeJS(){return"undefined"==typeof window}function flatten(data){return data.some(function(d){return Array.isArray(d)})?flatten(data.reduce(function(p,c){return p.concat(c)},[])):data}function nodeToString(process,node){return process.input.substring(node.offset,node.endPos)}function nodeContentToString(process,node){var minPos=Number.MAX_VALUE,maxPos=-1,childVisitor={visitDefaultPre:function(node){minPos=Math.min(minPos,node.offset),maxPos=Math.max(maxPos,node.endPos)}};return ReVIEW.visit(node,{visitDefaultPre:function(){},visitNodePre:function(node){return node.childNodes.forEach(function(child){return ReVIEW.visit(child,childVisitor)}),!1},visitHeadlinePre:function(node){return ReVIEW.visit(node.caption,childVisitor),!1},visitUlistPre:function(node){return ReVIEW.visit(node.text,childVisitor),!1},visitDlistPre:function(node){return ReVIEW.visit(node.text,childVisitor),ReVIEW.visit(node.content,childVisitor),!1},visitOlistPre:function(node){return ReVIEW.visit(node.text,childVisitor),!1},visitTextPre:function(){return ReVIEW.visit(node,childVisitor),!1}}),0>maxPos?"":process.input.substring(minPos,maxPos)}function findUp(node,predicate){var result=null;return ReVIEW.walk(node,function(node){return predicate(node)?(result=node,null):node.parentNode}),result}function findChapter(node,level){var chapter=null;return ReVIEW.walk(node,function(node){return node instanceof ReVIEW.Parse.ChapterSyntaxTree&&(chapter=node.toChapter(),"undefined"==typeof level||chapter.level===level)?null:node.parentNode}),chapter}function target2builder(target){var builderName=target.charAt(0).toUpperCase()+target.substring(1)+"Builder";for(var name in ReVIEW.Build)if(name===builderName)return new ReVIEW.Build[name];return null}function stringRepeat(times,src){return new Array(times+1).join(src)}ReVIEW.isNodeJS=isNodeJS,ReVIEW.flatten=flatten,ReVIEW.nodeToString=nodeToString,ReVIEW.nodeContentToString=nodeContentToString,ReVIEW.findUp=findUp,ReVIEW.findChapter=findChapter,ReVIEW.target2builder=target2builder,function(IO){function read(path){var fs=require("fs");return fs.readFileSync(path,"utf8")}function write(path,content){var fs=require("fs");fs.writeFileSync(path,content)}IO.read=read,IO.write=write}(ReVIEW.IO||(ReVIEW.IO={}));ReVIEW.IO;ReVIEW.stringRepeat=stringRepeat,function(Exec){function singleCompile(input,fileName,target,tmpConfig){var config=tmpConfig||{};config.read=config.read||function(){return input},config.analyzer=config.analyzer||new ReVIEW.Build.DefaultAnalyzer,config.validators=config.validators||[new ReVIEW.Build.DefaultValidator],target&&null==ReVIEW.target2builder(target)&&(console.error(target+" is not exists in builder"),process.exit(1)),config.builders=config.builders||target?[ReVIEW.target2builder(target)]:[new ReVIEW.Build.TextBuilder],config.book=config.book||{chapters:[fileName]},config.book.chapters=config.book.chapters||[fileName];var results={};config.write=config.write||function(path,content){return results[path]=content},config.listener=config.listener||{onReports:function(){},onCompileSuccess:function(){},onCompileFailed:function(){}},config.listener.onReports=config.listener.onReports||function(){},config.listener.onCompileSuccess=config.listener.onCompileSuccess||function(){},config.listener.onCompileFailed=config.listener.onCompileFailed||function(){};var success,originalCompileSuccess=config.listener.onCompileSuccess;config.listener.onCompileSuccess=function(book){success=!0,originalCompileSuccess(book)};var originalCompileFailed=config.listener.onCompileFailed;config.listener.onCompileFailed=function(){success=!1,originalCompileFailed()};var book=ReVIEW.start(function(review){review.initConfig(config)});return{success:function(callback){success&&callback({book:book,results:results})},failure:function(callback){success||callback({book:book})}}}Exec.singleCompile=singleCompile}(ReVIEW.Exec||(ReVIEW.Exec={}));ReVIEW.Exec}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){ReVIEW.ja={sample:"ããã¡ãã¼ãï¼",description:{headline:'ãã£ãã¿ã¼ã®å§ã¾ããç¤ºãã¾ãã\n"= è¦åºã" ã¨ããå½¢å¼ã§æ¸ãã¾ãã',ulist:"çªå·ãªãç®æ¡æ¸ããç¤ºãã¾ãã*è¨å·ãã¤ãªãã¦æ¸ãã¨ããã«ã¤ã³ãã³ãããç®æ¡æ¸ãã«ããäºãã§ãã¾ãã\n * é£æåãè²·ããã¨ã\n ** çä¹³\n ** ã«ããã\nã¨ããå½¢å¼ã§æ¸ãã¾ããè¡é ­ã«å¿ãåè§ã¹ãã¼ã¹ãå¿è¦ã§ãã",olist:"æ°å­ä»ãç®æ¡æ¸ããç¤ºãã¾ãã\n 1. ã¯ããã«ç¥ã¯å¤©ã¨å°ã¨ãæ³åãããã\n 2. å°ã¯å½¢ãªããããªããããã¿ãæ·µã®ããã¦ã«ãããç¥ã®éãæ°´ã®ããã¦ãããã£ã¦ããã\nã¨ããå½¢å¼ã§æ¸ãã¾ããè¡é ­ã«å¿ãåè§ã¹ãã¼ã¹ãå¿è¦ã§ãã",dlist:"ç¨èªãªã¹ããç¤ºãã¾ãã\n: ã¬ãã¬ãã£\n  ã¬ãã¼ãã¬ãã£ã¬ãã£åãããã¨ãçç·´èã¯ã¬ãã¬ãã£ãã¹ãæã¨ããªãæãæç¢ºã«ä½¿ãåãåå©ãæ´ã¿åãã\nã¨ããå½¢å¼ã§æ¸ãã¾ããæ¬æã®è¡ã¯åé ­ã«åè§ã¹ãã¼ã¹ãã¿ããå¿è¦ã§ãã",block_list:'ãªã¹ããç¤ºãã¾ããæè¡æ¸ã§ã¯ãã­ã°ã©ã ã³ã¼ãã®æ²è¼ã«ä½¿ãã¾ãã\n//list[label][caption]{\nalert("Hello!");\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã',inline_list:'ãªã¹ãã¸ã®åç§ãç¤ºãã¾ãã\n//list[hoge][caption]{alert("Hello!");\n//}\n ãåç§ããæã¯ @<list>{hoge} ã¨æ¸ãã¾ãã',block_listnum:'è¡çªå·ä»ãã®ãªã¹ããç¤ºãã¾ãã\n//listnum[hello.js][ãã­ã¼ã¯ã¼ã«ã]{\nconsole.log("Hello world!");\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã',block_emlist:'éæ¡çªã®ãªã¹ããç¤ºãã¾ãã\n//emlist[ãã­ã¼ã¯ã¼ã«ã]{\nconsole.log("Hello world");\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã',block_emlistnum:'è¡çªå·ä»ãã®éæ¡çªã®ãªã¹ããç¤ºãã¾ãã\n//emlistnum{\nconsole.log("Hello world");\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã',block_image:"å³è¡¨ãç¤ºãã¾ãã\n//image[sample][ãµã³ãã«][scale=0.3]{\nã¡ã¢\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã\nç« ã®ãã¡ã¤ã«åãtest.reã®å ´åãimages/test-sample.jpegãåç§ããã¾ãã\nç»åã®ãµã¤ãºãèª¿æ´ãããå ´åãscaleã§åçãæå®ã§ãã¾ãã\nä¸­ã«æ¸ããã¦ããã¡ã¢ã¯ç¡è¦ããã¾ãã",block_indepimage:"éæ¡çªã®å³è¡¨ãç¤ºãã¾ãã\n//image[sample][ãµã³ãã«][scale=0.3]{\nã¡ã¢\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ããè©³ç´°ã¯ //image ã¨åæ§ã§ãã",inline_img:"å³è¡¨ã¸ã®åç§ãç¤ºãã¾ãã\n//image[sample][ãµã³ãã«]{\n//}\nãåç§ããã¨ãã¯ @<img>{sample} ã¨æ¸ãã¾ãã",inline_icon:"æä¸­ã«è¡¨ç¤ºãããå³è¡¨ãç¤ºãã¾ãã\n@<icon>{sample}ã¨ããå½¢å¼ã§æ¸ãã¾ããç« ã®ãã¡ã¤ã«åãtest.reã®å ´åãimages/test-sample.jpenãåç§ããã¾ãã",block_footnote:"èæ³¨ãç¤ºãã¾ãã\n//footnote[sample][ãµã³ãã«ã¨ãã¦ã¯ããããè±ªè¯ãããããï¼]\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_fn:"èæ³¨ã¸ã®åç§ãç¤ºãã¾ãã\n//footnote[sample][ãµã³ãã«ã¨ããã«ã¯ã·ã§ãããã]\nãåç§ããã¨ãã¯ @<fn>{sample} ã¨æ¸ãã¾ãã",block_lead:"ãªã¼ãåãç¤ºãã¾ãã\n//lead{\nä¸çãå¤ãããã¯ãªããï¼\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ããleadè¨æ³ä¸­ã§ã¯ãå¨ã¦ã®ã¤ã³ã©ã¤ã³æ§æããã­ãã¯æ§æãå©ç¨ã§ãã¾ãã",block_noindent:"ãã©ã°ã©ããåããã«æ¬¡ã®è¦ç´ ãç¶ãããã¨ãç¤ºãã¾ãã\n//noindent\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",block_source:'ã½ã¼ã¹ã³ã¼ãã®å¼ç¨ãç¤ºãã¾ãã\n//source[hello.js]{\nconsole.log("Hello world!");\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã',block_cmd:"ã³ãã³ãã©ã¤ã³ã®ã­ã£ããã£ãç¤ºãã¾ãã\n//cmd{\n$ git clone git@github.com:vvakame/review.js.git\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",block_quote:"å¼ç¨ãç¤ºãã¾ãã\n//quote{\nç¥ã¯è¨ã£ã¦ããâ¦ããã§æ­»ã¬å®ãã§ã¯ãªãã¨â¦\n//}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_hd:"TODO å¾ã§æ¸ããè¦åºãåç§ãä½æããã",inline_code:'ç­ããã­ã°ã©ã ã³ã¼ããè¨è¿°ãã¾ãã\n@<code>{alert("Hello!");}\né·ãã½ã¼ã¹ã³ã¼ãã«ã¯listè¨æ³ãä½¿ãã¾ãããã',inline_br:"æ¹è¡ãç¤ºãã¾ãããªã¹ãåã§ã®æ¹è¡ããæ®µè½ãå¤ããã«æ¹è¡ããããå ´åã«ä½¿ãã¾ãã",inline_u:"ä¸ç·ã«ãã¾ãã\n@<u>{ãã®é¨åãä¸ç·ã«ãªã}",inline_ruby:"èª­ã¿ä»®åãæ¯ãã¾ãã\n@<ruby>{ç¾,ã²ã¤ã}",inline_b:"ãã¼ã«ã(å¤ªå­)ã«ãã¾ãã\n@<b>{ãã®é¨åãå¤ªå­ã«ãªã}",inline_href:"ãªã³ã¯ãç¤ºãã¾ãã\nURLãæ¸ãããå ´åã«ä½¿ãã¾ãã\n@<href>{https://github.com/vvakame/review.js} ã¾ãã¯ @<href>{https://github.com/vvakame/review.js, review.js} ã¨ããå½¢å¼ã§æ¸ãã¾ãã",block_label:"ã¢ã³ã«ã¼ãç¤ºãã¾ãã\n@<href>{#anchor}ããé£ãã§æ¥ãããããã«ããããã«ã¯\n//label[anchor]\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_kw:"ã­ã¼ã¯ã¼ããç¤ºãã¾ãã\nããã¯ããããã ãã@<kw>{JK, å¸¸è­çã«èãã¦}ã\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_tti:"ãã¬ã¿ã¤ãæå­(ç­å¹ãã©ã³ã)ã®ã¤ã¿ãªãã¯ã§åºåãããã¨ãç¤ºãã¾ãã\n@<tti>{keyword}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_ttb:"ãã¬ã¿ã¤ãæå­(ç­å¹ãã©ã³ã)ã®ãã¼ã«ãã§åºåãããã¨ãç¤ºãã¾ãã\n@<ttb>{class}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_ami:"ç¶²æãæãã§åºåãããã¨ãç¤ºãã¾ãã\n@<ami>{éç¹ï¼}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_bou:"åç¹æãã§åºåãããã¨ãç¤ºãã¾ãã\n@<bou>{ãªãã ã£ã¦ï¼}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_i:"ã¤ã¿ãªãã¯ã§åºåãããã¨ãç¤ºãã¾ãã\n@<i>{æä½}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_strong:"ãã¼ã«ãã§åºåãããã¨ãç¤ºãã¾ãã\n@<strong>{å¼·èª¿ï¼}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_uchar:"æå®ãããå¤ã16é²æ°ã®å¤ã¨ãã¦æ±ããUnicodeæå­ã¨ãã¦åºåãããã¨ãç¤ºãã¾ãã\n@<uchar>{1F64B}\nã¨ããå½¢å¼ã§æ¸ãã¾ãã",inline_tt:"å²ã¾ãããã­ã¹ããç­å¹ãã©ã³ãã§è¡¨ç¤ºãã¾ãã",inline_em:"ãã­ã¹ããå¼·èª¿ãã¾ãã\n@<em>{ãã®ããã«å¼·èª¿ããã¾ã}"},compile:{file_not_exists:"ãã¡ã¤ã« %s ãéãã¾ãã",block_not_supported:"%s ã¨ãããã­ãã¯æ§æã¯ãµãã¼ãããã¦ãã¾ãã",inline_not_supported:"%s ã¨ããã¤ã³ã©ã¤ã³æ§æã¯ãµãã¼ãããã¦ãã¾ãã",part_is_missing:"ãã¼ã %s ãè¦ã¤ããã¾ãã",chapter_is_missing:"ãã£ãã¿ã¼ %s ãè¦ã¤ããã¾ãã",reference_is_missing:"åç§å %s ã® %s ãè¦ã¤ããã¾ãã",duplicated_label:"ã©ãã«ã«éè¤ãããããã§ã",args_length_mismatch:"å¼æ°ã®æ°ã«é½é½¬ãããã¾ã æå¾å¤ %s, å®é %s",body_string_only:"åå®¹ã¯å¨ã¦æå­ã§ãªããã°ããã¾ãã",chapter_not_toplevel:"æ·±ã1ã®ãã£ãã¿ã¼ã¯æä¸ä½ã«ãªããã°ããã¾ãã",chapter_topleve_eq1:"æä¸ä½ã®ãã£ãã¿ã¼ã¯æ·±ã1ã®ãã®ã§ãªããã°ããã¾ãã",chapter_level_omission:"æ·±ã%sã®ãã£ãã¿ã¼ã¯æ·±ã%sã®ãã£ãã¿ã¼ã«å±ãã¦ããªããã°ããã¾ãã ä»ã¯æ·±ã%sã®ãã£ãã¿ã¼ã®ä¸ã«ãã¾ã",deprecated_inline_symbol:"%s ã¨ããã¤ã³ã©ã¤ã³æ§æã¯éæ¨å¥¨ã§ãã"},builder:{chapter:"ç¬¬%dç« ",list:"ãªã¹ã%s.%s"}}
}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){ReVIEW.en={sample:"Hello!"}}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(i18n){function setup(lang){"undefined"==typeof lang&&(lang="ja"),"undefined"!=typeof i18next.backend?(i18next.backend({fetchOne:function(lng,ns,func){func(null,data[lng]||data[lang])}}),i18next.init({lng:lang})):i18next.init({lng:lang,customLoad:function(lng,ns,options,loadComplete){loadComplete(null,data[lng]||data["ja-JP"])}})}function t(str){for(var args=[],_i=0;_i<arguments.length-1;_i++)args[_i]=arguments[_i+1];return i18next.t(str,{postProcess:"sprintf",sprintf:args})}i18n.setup=setup,i18n.t=t;var i18next;i18next=ReVIEW.isNodeJS()?require("i18next"):window.i18n;var data={ja:ReVIEW.ja,en:ReVIEW.en};setup()}(ReVIEW.i18n||(ReVIEW.i18n={}));ReVIEW.i18n}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){function walk(ast,actor){var next=actor(ast);next&&walk(next,actor)}function visit(ast,v){var newV={visitDefaultPre:v.visitDefaultPre,visitDefaultPost:v.visitDefaultPost||function(){},visitBlockElementPre:v.visitBlockElementPre||v.visitNodePre||v.visitDefaultPre,visitBlockElementPost:v.visitBlockElementPost||v.visitNodePost||v.visitDefaultPost||function(){},visitInlineElementPre:v.visitInlineElementPre||v.visitNodePre||v.visitDefaultPre,visitInlineElementPost:v.visitInlineElementPost||v.visitNodePost||v.visitDefaultPost||function(){},visitNodePre:v.visitNodePre||v.visitDefaultPre,visitNodePost:v.visitNodePost||v.visitDefaultPost||function(){},visitArgumentPre:v.visitArgumentPre||v.visitDefaultPre,visitArgumentPost:v.visitArgumentPost||v.visitDefaultPost||function(){},visitChapterPre:v.visitChapterPre||v.visitNodePre||v.visitDefaultPre,visitChapterPost:v.visitChapterPost||v.visitNodePost||v.visitDefaultPost||function(){},visitParagraphPre:v.visitParagraphPre||v.visitNodePre||v.visitDefaultPre,visitParagraphPost:v.visitParagraphPost||v.visitNodePost||function(){},visitHeadlinePre:v.visitHeadlinePre||v.visitDefaultPre,visitHeadlinePost:v.visitHeadlinePost||v.visitDefaultPost||function(){},visitUlistPre:v.visitUlistPre||v.visitNodePre||v.visitDefaultPre,visitUlistPost:v.visitUlistPost||v.visitNodePost||v.visitDefaultPost||function(){},visitOlistPre:v.visitOlistPre||v.visitDefaultPre,visitOlistPost:v.visitOlistPost||v.visitDefaultPost||function(){},visitDlistPre:v.visitDlistPre||v.visitDefaultPre,visitDlistPost:v.visitDlistPost||v.visitDefaultPost||function(){},visitTextPre:v.visitTextPre||v.visitDefaultPre,visitTextPost:v.visitTextPost||v.visitDefaultPost||function(){}};newV.visitDefaultPre=newV.visitDefaultPre.bind(v),newV.visitDefaultPost=newV.visitDefaultPost.bind(v),newV.visitBlockElementPre=newV.visitBlockElementPre.bind(v),newV.visitBlockElementPost=newV.visitBlockElementPost.bind(v),newV.visitInlineElementPre=newV.visitInlineElementPre.bind(v),newV.visitInlineElementPost=newV.visitInlineElementPost.bind(v),newV.visitNodePre=newV.visitNodePre.bind(v),newV.visitNodePost=newV.visitNodePost.bind(v),newV.visitArgumentPre=newV.visitArgumentPre.bind(v),newV.visitArgumentPost=newV.visitArgumentPost.bind(v),newV.visitChapterPre=newV.visitChapterPre.bind(v),newV.visitChapterPost=newV.visitChapterPost.bind(v),newV.visitHeadlinePre=newV.visitHeadlinePre.bind(v),newV.visitHeadlinePost=newV.visitHeadlinePost.bind(v),newV.visitUlistPre=newV.visitUlistPre.bind(v),newV.visitUlistPost=newV.visitUlistPost.bind(v),newV.visitOlistPre=newV.visitOlistPre.bind(v),newV.visitOlistPost=newV.visitOlistPost.bind(v),newV.visitDlistPre=newV.visitDlistPre.bind(v),newV.visitDlistPost=newV.visitDlistPost.bind(v),newV.visitTextPre=newV.visitTextPre.bind(v),newV.visitTextPost=newV.visitTextPost.bind(v),visitSub(null,ast,newV)}function visitSub(parent,ast,v){if(ast instanceof ReVIEW.Parse.BlockElementSyntaxTree){var block=ast.toBlockElement(),ret=v.visitBlockElementPre(block,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?(block.args.forEach(function(next){visitSub(ast,next,v)}),block.childNodes.forEach(function(next){visitSub(ast,next,v)})):"function"==typeof ret&&ret(v),v.visitBlockElementPost(block,parent)}else if(ast instanceof ReVIEW.Parse.InlineElementSyntaxTree){var inline=ast.toInlineElement(),ret=v.visitInlineElementPre(inline,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?inline.childNodes.forEach(function(next){visitSub(ast,next,v)}):"function"==typeof ret&&ret(v),v.visitInlineElementPost(inline,parent)}else if(ast instanceof ReVIEW.Parse.ArgumentSyntaxTree){var arg=ast.toArgument(),ret=v.visitArgumentPre(arg,parent);"function"==typeof ret&&ret(v),v.visitArgumentPost(arg,parent)}else if(ast instanceof ReVIEW.Parse.ChapterSyntaxTree){var chap=ast.toChapter(),ret=v.visitChapterPre(chap,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?(visitSub(ast,chap.headline,v),chap.text&&chap.text.forEach(function(next){visitSub(ast,next,v)}),chap.childNodes.forEach(function(next){visitSub(ast,next,v)})):"function"==typeof ret&&ret(v),v.visitChapterPost(chap,parent)}else if(ast instanceof ReVIEW.Parse.HeadlineSyntaxTree){var head=ast.toHeadline(),ret=v.visitHeadlinePre(head,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?(visitSub(ast,head.cmd,v),visitSub(ast,head.label,v),visitSub(ast,head.caption,v)):"function"==typeof ret&&ret(v),v.visitHeadlinePost(head,parent)}else if(ast instanceof ReVIEW.Parse.UlistElementSyntaxTree){var ul=ast.toUlist(),ret=v.visitUlistPre(ul,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?(visitSub(ast,ul.text,v),ul.childNodes.forEach(function(next){visitSub(ast,next,v)})):"function"==typeof ret&&ret(v),v.visitUlistPost(ul,parent)}else if(ast instanceof ReVIEW.Parse.OlistElementSyntaxTree){var ol=ast.toOlist(),ret=v.visitOlistPre(ol,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?visitSub(ast,ol.text,v):"function"==typeof ret&&ret(v),v.visitOlistPost(ol,parent)}else if(ast instanceof ReVIEW.Parse.DlistElementSyntaxTree){var dl=ast.toDlist(),ret=v.visitDlistPre(dl,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?(visitSub(ast,dl.text,v),visitSub(ast,dl.content,v)):"function"==typeof ret&&ret(v),v.visitDlistPost(dl,parent)}else if(ast instanceof ReVIEW.Parse.NodeSyntaxTree&&(ast.ruleName===ReVIEW.Parse.RuleName.Paragraph||ast.ruleName===ReVIEW.Parse.RuleName.BlockElementParagraph)){var node=ast.toNode(),ret=v.visitParagraphPre(node,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?node.childNodes.forEach(function(next){visitSub(ast,next,v)}):"function"==typeof ret&&ret(v),v.visitParagraphPost(node,parent)}else if(ast instanceof ReVIEW.Parse.NodeSyntaxTree){var node=ast.toNode(),ret=v.visitNodePre(node,parent);"undefined"==typeof ret||"boolean"==typeof ret&&ret?node.childNodes.forEach(function(next){visitSub(ast,next,v)}):"function"==typeof ret&&ret(v),v.visitNodePost(node,parent)}else if(ast instanceof ReVIEW.Parse.TextNodeSyntaxTree){var text=ast.toTextNode(),ret=v.visitTextPre(text,parent);"function"==typeof ret&&ret(v),v.visitTextPost(text,parent)}else if(ast){var ret=v.visitDefaultPre(parent,ast);"function"==typeof ret&&ret(v),v.visitDefaultPost(parent,ast)}}!function(){}(ReVIEW.Parse||(ReVIEW.Parse={}));ReVIEW.Parse,ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.ArgumentSyntaxTree,ReVIEW.Parse.ChapterSyntaxTree,ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.UlistElementSyntaxTree,ReVIEW.Parse.OlistElementSyntaxTree,ReVIEW.Parse.DlistElementSyntaxTree,ReVIEW.Parse.NodeSyntaxTree,ReVIEW.Parse.TextNodeSyntaxTree;ReVIEW.walk=walk,ReVIEW.visit=visit}(ReVIEW||(ReVIEW={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},ReVIEW;!function(ReVIEW){!function(Parse){function parse(input){var rawResult=PEG.parse(input),root=transform(rawResult).toNode();ReVIEW.visit(root,{visitDefaultPre:function(){},visitParagraphPre:function(ast){var subs=ast.childNodes[0].toNode();ast.childNodes=subs.childNodes}}),0!==root.childNodes.length&&reconstruct(root.childNodes[0].toNode(),function(chapter){return chapter.headline.level});var ulistSet=[];return ReVIEW.visit(root,{visitDefaultPre:function(ast){ast.ruleName===RuleName.Ulist&&ulistSet.push(ast.toNode())}}),ulistSet.forEach(function(ulist){reconstruct(ulist,function(ulistElement){return ulistElement.level})}),ReVIEW.visit(root,{visitDefaultPre:function(ast,parent){ast.parentNode=parent}}),ReVIEW.visit(root,{visitDefaultPre:function(){},visitChapterPre:function(ast){ast.text.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})},visitNodePre:function(ast){ast.childNodes.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})}}),{ast:root,cst:rawResult}}function transform(rawResult){if(""===rawResult)return null;var rule=RuleName[rawResult.syntax];if("undefined"==typeof rule)throw new ParseError(rawResult,"unknown rule: "+rawResult.syntax);switch(rule){case RuleName.Chapter:return new ChapterSyntaxTree(rawResult);case RuleName.BlockElement:return new BlockElementSyntaxTree(rawResult);case RuleName.Headline:return new HeadlineSyntaxTree(rawResult);case RuleName.InlineElement:return new InlineElementSyntaxTree(rawResult);case RuleName.BracketArg:case RuleName.BraceArg:return new ArgumentSyntaxTree(rawResult);case RuleName.UlistElement:return new UlistElementSyntaxTree(rawResult);case RuleName.OlistElement:return new OlistElementSyntaxTree(rawResult);case RuleName.DlistElement:return new DlistElementSyntaxTree(rawResult);case RuleName.ContentText:case RuleName.BlockElementContentText:case RuleName.InlineElementContentText:case RuleName.ContentInlineText:case RuleName.SinglelineComment:return new TextNodeSyntaxTree(rawResult);case RuleName.Chapters:case RuleName.Contents:case RuleName.ParagraphSubs:case RuleName.BlockElementContents:case RuleName.BlockElementParagraphSubs:case RuleName.InlineElementContents:case RuleName.ContentInlines:case RuleName.Ulist:case RuleName.Olist:case RuleName.Dlist:return new NodeSyntaxTree(rawResult);case RuleName.Start:case RuleName.Paragraph:case RuleName.BlockElementParagraph:case RuleName.BlockElementParagraphSub:case RuleName.DlistElementContent:return new NodeSyntaxTree(rawResult);case RuleName.Content:case RuleName.ParagraphSub:case RuleName.BlockElementContent:case RuleName.InlineElementContent:case RuleName.SinglelineContent:case RuleName.ContentInline:return transform(rawResult.content);default:return new SyntaxTree(rawResult)}}function reconstruct(node,pickLevel){var originalChildNodes=node.childNodes,nodeSets=[],currentSet={parent:null,children:[]};originalChildNodes.forEach(function(child){child.ruleName===RuleName.SinglelineComment?currentSet.children.push(child):currentSet.parent?pickLevel(currentSet.parent)<pickLevel(child)?currentSet.children.push(child):(nodeSets.push(currentSet),currentSet={parent:child,children:[]}):currentSet.parent=child}),currentSet.parent&&nodeSets.push(currentSet),node.childNodes=[],nodeSets.forEach(function(nodes){var parent=nodes.parent;node.childNodes.push(parent),nodes.children.forEach(function(child){parent.childNodes.push(child)}),reconstruct(parent,pickLevel)})}Parse.parse=parse,Parse.transform=transform;var ParseError=function(){function ParseError(syntax,message){this.syntax=syntax,this.message=message,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError),this.name="ParseError"}return ParseError}();Parse.ParseError=ParseError,function(RuleName){RuleName[RuleName.SyntaxError=0]="SyntaxError",RuleName[RuleName.Start=1]="Start",RuleName[RuleName.Chapters=2]="Chapters",RuleName[RuleName.Chapter=3]="Chapter",RuleName[RuleName.Headline=4]="Headline",RuleName[RuleName.Contents=5]="Contents",RuleName[RuleName.Content=6]="Content",RuleName[RuleName.Paragraph=7]="Paragraph",RuleName[RuleName.ParagraphSubs=8]="ParagraphSubs",RuleName[RuleName.ParagraphSub=9]="ParagraphSub",RuleName[RuleName.ContentText=10]="ContentText",RuleName[RuleName.BlockElement=11]="BlockElement",RuleName[RuleName.InlineElement=12]="InlineElement",RuleName[RuleName.BracketArg=13]="BracketArg",RuleName[RuleName.BraceArg=14]="BraceArg",RuleName[RuleName.BlockElementContents=15]="BlockElementContents",RuleName[RuleName.BlockElementContent=16]="BlockElementContent",RuleName[RuleName.BlockElementParagraph=17]="BlockElementParagraph",RuleName[RuleName.BlockElementParagraphSubs=18]="BlockElementParagraphSubs",RuleName[RuleName.BlockElementParagraphSub=19]="BlockElementParagraphSub",RuleName[RuleName.BlockElementContentText=20]="BlockElementContentText",RuleName[RuleName.InlineElementContents=21]="InlineElementContents",RuleName[RuleName.InlineElementContent=22]="InlineElementContent",RuleName[RuleName.InlineElementContentText=23]="InlineElementContentText",RuleName[RuleName.SinglelineContent=24]="SinglelineContent",RuleName[RuleName.ContentInlines=25]="ContentInlines",RuleName[RuleName.ContentInline=26]="ContentInline",RuleName[RuleName.ContentInlineText=27]="ContentInlineText",RuleName[RuleName.Ulist=28]="Ulist",RuleName[RuleName.UlistElement=29]="UlistElement",RuleName[RuleName.Olist=30]="Olist",RuleName[RuleName.OlistElement=31]="OlistElement",RuleName[RuleName.Dlist=32]="Dlist",RuleName[RuleName.DlistElement=33]="DlistElement",RuleName[RuleName.DlistElementContent=34]="DlistElementContent",RuleName[RuleName.SinglelineComment=35]="SinglelineComment"}(Parse.RuleName||(Parse.RuleName={}));var RuleName=Parse.RuleName,SyntaxTree=function(){function SyntaxTree(data){if(this.ruleName=RuleName[data.syntax],"undefined"==typeof this.ruleName)throw new ParseError(data,"unknown rule: "+data.syntax);this.offset=data.offset,this.line=data.line,this.column=data.column,this.endPos=data.endPos}return SyntaxTree.prototype.toJSON=function(){var result={};for(var k in this)"ruleName"===k?result[k]=RuleName[this[k]]:"prev"===k||"next"===k||"fqn"===k||"parentNode"!==k&&"function"!=typeof this[k]&&(result[k]=this[k]);return result},SyntaxTree.prototype.toString=function(indentLevel){"undefined"==typeof indentLevel&&(indentLevel=0);var result=this.makeIndent(indentLevel)+"SyntaxTree:[\n";return result+=this.makeIndent(indentLevel+1)+"offset = "+this.offset+",\n",result+=this.makeIndent(indentLevel+1)+"line="+this.line+",\n",result+=this.makeIndent(indentLevel+1)+"column="+this.column+",\n",result+=this.makeIndent(indentLevel+1)+"name="+RuleName[this.ruleName]+",\n",this.toStringHook(indentLevel,result),result+=this.makeIndent(indentLevel)+"]"},SyntaxTree.prototype.makeIndent=function(indentLevel){for(var indent="",i=0;indentLevel>i;i++)indent+="  ";return indent},SyntaxTree.prototype.toStringHook=function(){},SyntaxTree.prototype.checkNumber=function(value){if("number"!=typeof value)throw new Error("number required. actual:"+typeof value+":"+value);return value},SyntaxTree.prototype.checkString=function(value){if("string"!=typeof value)throw new Error("string required. actual:"+typeof value+":"+value);return value},SyntaxTree.prototype.checkObject=function(value){if("object"!=typeof value)throw new Error("object required. actual:"+typeof value+":"+value);return value},SyntaxTree.prototype.checkArray=function(value){if(Array.isArray(value))return value;throw new Error("array required. actual:"+typeof value+":"+value)},SyntaxTree.prototype.checkSyntaxType=function(clazz){return this instanceof clazz},SyntaxTree.prototype.isNode=function(){return this.checkSyntaxType(NodeSyntaxTree)},SyntaxTree.prototype.isBlockElement=function(){return this.checkSyntaxType(BlockElementSyntaxTree)},SyntaxTree.prototype.isInlineElement=function(){return this.checkSyntaxType(InlineElementSyntaxTree)},SyntaxTree.prototype.isArgument=function(){return this.checkSyntaxType(ArgumentSyntaxTree)},SyntaxTree.prototype.isChapter=function(){return this.checkSyntaxType(ChapterSyntaxTree)},SyntaxTree.prototype.isHeadline=function(){return this.checkSyntaxType(HeadlineSyntaxTree)},SyntaxTree.prototype.isUlist=function(){return this.checkSyntaxType(UlistElementSyntaxTree)},SyntaxTree.prototype.isOlist=function(){return this.checkSyntaxType(OlistElementSyntaxTree)},SyntaxTree.prototype.isDlist=function(){return this.checkSyntaxType(DlistElementSyntaxTree)},SyntaxTree.prototype.isTextNode=function(){return this.checkSyntaxType(TextNodeSyntaxTree)},SyntaxTree.prototype.toOtherNode=function(clazz){if(this instanceof clazz)return this;throw new Error("this node is not "+clazz.name+", actual "+this.constructor.name)},SyntaxTree.prototype.toNode=function(){return this.toOtherNode(NodeSyntaxTree)},SyntaxTree.prototype.toBlockElement=function(){return this.toOtherNode(BlockElementSyntaxTree)},SyntaxTree.prototype.toInlineElement=function(){return this.toOtherNode(InlineElementSyntaxTree)},SyntaxTree.prototype.toArgument=function(){return this.toOtherNode(ArgumentSyntaxTree)},SyntaxTree.prototype.toChapter=function(){return this.toOtherNode(ChapterSyntaxTree)},SyntaxTree.prototype.toHeadline=function(){return this.toOtherNode(HeadlineSyntaxTree)},SyntaxTree.prototype.toUlist=function(){return this.toOtherNode(UlistElementSyntaxTree)},SyntaxTree.prototype.toOlist=function(){return this.toOtherNode(OlistElementSyntaxTree)},SyntaxTree.prototype.toDlist=function(){return this.toOtherNode(DlistElementSyntaxTree)},SyntaxTree.prototype.toTextNode=function(){return this.toOtherNode(TextNodeSyntaxTree)},SyntaxTree}();Parse.SyntaxTree=SyntaxTree;var NodeSyntaxTree=function(_super){function NodeSyntaxTree(data){_super.call(this,data),this.childNodes=[],this.processChildNodes(data.content)}return __extends(NodeSyntaxTree,_super),NodeSyntaxTree.prototype.processChildNodes=function(content){var _this=this;Array.isArray(content)?content.forEach(function(rawResult){var tree=transform(rawResult);tree&&_this.childNodes.push(tree)}):""!==content&&content&&!function(rawResult){var tree=transform(rawResult);tree&&_this.childNodes.push(tree)}(content)},NodeSyntaxTree.prototype.toStringHook=function(indentLevel,result){0!==this.childNodes.length&&(result+=this.makeIndent(indentLevel+1)+"childNodes["+this.childNodes.length+"]=[\n",this.childNodes.forEach(function(node){result+=node.toString(indentLevel+2),result+="\n"}),result+=this.makeIndent(indentLevel+1)+"]\n")},NodeSyntaxTree}(SyntaxTree);Parse.NodeSyntaxTree=NodeSyntaxTree;var ChapterSyntaxTree=function(_super){function ChapterSyntaxTree(data){return _super.call(this,data),this.headline=transform(this.checkObject(data.headline)).toHeadline(),"string"==typeof data.text?(this.text=[],void 0):(this.text=this.checkArray(data.text.content).map(function(data){return transform(data)}),delete this.childNodes,this.childNodes=[],void 0)}return __extends(ChapterSyntaxTree,_super),Object.defineProperty(ChapterSyntaxTree.prototype,"level",{get:function(){return this.headline.level},enumerable:!0,configurable:!0}),Object.defineProperty(ChapterSyntaxTree.prototype,"fqn",{get:function(){var chapters=[];ReVIEW.walk(this,function(node){return node instanceof ReVIEW.Parse.ChapterSyntaxTree&&chapters.unshift(node.toChapter()),node.parentNode});var result=chapters.map(function(chapter){return chapter.no}).join(".");return result},enumerable:!0,configurable:!0}),ChapterSyntaxTree}(NodeSyntaxTree);Parse.ChapterSyntaxTree=ChapterSyntaxTree;var HeadlineSyntaxTree=function(_super){function HeadlineSyntaxTree(data){_super.call(this,data),this.level=this.checkNumber(data.level),""!==data.cmd&&(this.cmd=transform(this.checkObject(data.cmd)).toArgument()),""!==data.label&&(this.label=transform(this.checkObject(data.label)).toArgument()),this.caption=transform(this.checkObject(data.caption)).toNode()}return __extends(HeadlineSyntaxTree,_super),HeadlineSyntaxTree}(SyntaxTree);Parse.HeadlineSyntaxTree=HeadlineSyntaxTree;var BlockElementSyntaxTree=function(_super){function BlockElementSyntaxTree(data){_super.call(this,data),this.symbol=this.checkString(data.symbol),this.args=this.checkArray(data.args).map(function(data){return transform(data).toArgument()})}return __extends(BlockElementSyntaxTree,_super),BlockElementSyntaxTree}(NodeSyntaxTree);Parse.BlockElementSyntaxTree=BlockElementSyntaxTree;var InlineElementSyntaxTree=function(_super){function InlineElementSyntaxTree(data){_super.call(this,data),this.symbol=this.checkString(data.symbol)}return __extends(InlineElementSyntaxTree,_super),InlineElementSyntaxTree}(NodeSyntaxTree);Parse.InlineElementSyntaxTree=InlineElementSyntaxTree;var ArgumentSyntaxTree=function(_super){function ArgumentSyntaxTree(data){_super.call(this,data),this.arg=this.checkString(data.arg)}return __extends(ArgumentSyntaxTree,_super),ArgumentSyntaxTree}(SyntaxTree);Parse.ArgumentSyntaxTree=ArgumentSyntaxTree;var UlistElementSyntaxTree=function(_super){function UlistElementSyntaxTree(data){_super.call(this,data),this.level=this.checkNumber(data.level),this.text=transform(this.checkObject(data.text)),delete this.childNodes,this.childNodes=[]}return __extends(UlistElementSyntaxTree,_super),UlistElementSyntaxTree}(NodeSyntaxTree);Parse.UlistElementSyntaxTree=UlistElementSyntaxTree;var OlistElementSyntaxTree=function(_super){function OlistElementSyntaxTree(data){_super.call(this,data),this.no=this.checkNumber(data.no),this.text=transform(this.checkObject(data.text))}return __extends(OlistElementSyntaxTree,_super),OlistElementSyntaxTree}(SyntaxTree);Parse.OlistElementSyntaxTree=OlistElementSyntaxTree;var DlistElementSyntaxTree=function(_super){function DlistElementSyntaxTree(data){_super.call(this,data),this.text=transform(this.checkObject(data.text)),this.content=transform(this.checkObject(data.content))}return __extends(DlistElementSyntaxTree,_super),DlistElementSyntaxTree}(SyntaxTree);Parse.DlistElementSyntaxTree=DlistElementSyntaxTree;var TextNodeSyntaxTree=function(_super){function TextNodeSyntaxTree(data){_super.call(this,data),this.text=this.checkString(data.text).replace(/\n+$/,"")}return __extends(TextNodeSyntaxTree,_super),TextNodeSyntaxTree}(SyntaxTree);Parse.TextNodeSyntaxTree=TextNodeSyntaxTree}(ReVIEW.Parse||(ReVIEW.Parse={}));ReVIEW.Parse}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(Build){{var t=ReVIEW.i18n.t;ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.NodeSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.TextNodeSyntaxTree,ReVIEW.Parse.ChapterSyntaxTree}!function(SyntaxType){SyntaxType[SyntaxType.Block=0]="Block",SyntaxType[SyntaxType.Inline=1]="Inline",SyntaxType[SyntaxType.Other=2]="Other"}(Build.SyntaxType||(Build.SyntaxType={}));var SyntaxType=Build.SyntaxType,AcceptableSyntaxes=function(){function AcceptableSyntaxes(acceptableSyntaxes){this.acceptableSyntaxes=acceptableSyntaxes}return AcceptableSyntaxes.prototype.find=function(node){var results;if(node instanceof ReVIEW.Parse.InlineElementSyntaxTree){var inline=node.toInlineElement();results=this.inlines.filter(function(s){return s.symbolName===inline.symbol})}else if(node instanceof ReVIEW.Parse.BlockElementSyntaxTree){var block=node.toBlockElement();results=this.blocks.filter(function(s){return s.symbolName===block.symbol})}else results=this.others.filter(function(s){return node instanceof s.clazz});return results},Object.defineProperty(AcceptableSyntaxes.prototype,"inlines",{get:function(){return this.acceptableSyntaxes.filter(function(s){return s.type===SyntaxType.Inline})},enumerable:!0,configurable:!0}),Object.defineProperty(AcceptableSyntaxes.prototype,"blocks",{get:function(){return this.acceptableSyntaxes.filter(function(s){return s.type===SyntaxType.Block})},enumerable:!0,configurable:!0}),Object.defineProperty(AcceptableSyntaxes.prototype,"others",{get:function(){return this.acceptableSyntaxes.filter(function(s){return s.type===SyntaxType.Other})},enumerable:!0,configurable:!0}),AcceptableSyntaxes.prototype.toJSON=function(){return{rev:"1",SyntaxType:SyntaxType,acceptableSyntaxes:this.acceptableSyntaxes}},AcceptableSyntaxes}();Build.AcceptableSyntaxes=AcceptableSyntaxes;var AcceptableSyntax=function(){function AcceptableSyntax(){this.argsLength=[],this.allowInline=!0,this.allowFullySyntax=!1}return AcceptableSyntax.prototype.toJSON=function(){return{type:this.type,"class":this.clazz?this.clazz.name:void 0,symbolName:this.symbolName,argsLength:0!==this.argsLength.length?this.argsLength:void 0,description:this.description}},AcceptableSyntax}();Build.AcceptableSyntax=AcceptableSyntax;var AnalyzeProcess=function(){function AnalyzeProcess(){this.acceptableSyntaxes=[]}return AnalyzeProcess.prototype.prepare=function(){this.current=new AcceptableSyntax},AnalyzeProcess.prototype.build=function(methodName){switch(0===methodName.indexOf("block_")?(this.current.type=this.current.type||SyntaxType.Block,this.current.symbolName=this.current.symbolName||methodName.substring("block_".length)):0===methodName.indexOf("inline_")?(this.current.type=this.current.type||SyntaxType.Inline,this.current.symbolName=this.current.symbolName||methodName.substring("inline_".length)):(this.current.type=this.current.type||SyntaxType.Other,this.current.symbolName=this.current.symbolName||methodName),this.current.type){case SyntaxType.Block:if(0===this.current.argsLength.length)throw new Build.AnalyzerError("must call builder.checkArgsLength(...number[]) in "+methodName);break;case SyntaxType.Other:if(!this.current.clazz)throw new Build.AnalyzerError("must call builder.setClass(class) in "+methodName);break;case SyntaxType.Inline:}if(!this.current.description)throw new Build.AnalyzerError("must call builder.setDescription(string) in "+methodName);if(!this.current.process)throw new Build.AnalyzerError("must call builder.processNode(func) in "+methodName);this.acceptableSyntaxes.push(this.current)},AnalyzeProcess.prototype.setSyntaxType=function(type){this.current.type=type},AnalyzeProcess.prototype.setClass=function(clazz){this.current.clazz=clazz},AnalyzeProcess.prototype.setSymbol=function(symbolName){this.current.symbolName=symbolName},AnalyzeProcess.prototype.setDescription=function(description){this.current.description=description},AnalyzeProcess.prototype.checkArgsLength=function(){for(var argsLength=[],_i=0;_i<arguments.length-0;_i++)argsLength[_i]=arguments[_i+0];this.current.argsLength=argsLength},AnalyzeProcess.prototype.setAllowInline=function(enable){this.current.allowInline=enable},AnalyzeProcess.prototype.setAllowFullySyntax=function(enable){this.current.allowFullySyntax=enable},AnalyzeProcess.prototype.processNode=function(func){this.current.process=func},AnalyzeProcess}(),DefaultAnalyzer=function(){function DefaultAnalyzer(){}return DefaultAnalyzer.prototype.getAcceptableSyntaxes=function(){return this._acceptableSyntaxes||(this._acceptableSyntaxes=this.constructAcceptableSyntaxes()),new AcceptableSyntaxes(this._acceptableSyntaxes)},DefaultAnalyzer.prototype.constructAcceptableSyntaxes=function(){var process=new AnalyzeProcess;for(var k in this)if("function"==typeof this[k]){var func=null;0===k.indexOf("block_")?func=this[k]:0===k.indexOf("inline_")?func=this[k]:"headline"===k?func=this[k]:"ulist"===k?func=this[k]:"olist"===k?func=this[k]:"dlist"===k&&(func=this[k]),func&&(process.prepare(),func.bind(this)(process),process.build(k))}return process.acceptableSyntaxes},DefaultAnalyzer.prototype.headline=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(ReVIEW.Parse.HeadlineSyntaxTree),builder.setDescription(t("description.headline")),builder.processNode(function(process,n){var node=n.toHeadline(),label=null;if(node.label)label=node.label.arg;else if(1===node.caption.childNodes.length){var textNode=node.caption.childNodes[0].toTextNode();label=textNode.text}process.addSymbol({symbolName:"hd",labelName:label,node:node})})},DefaultAnalyzer.prototype.ulist=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(ReVIEW.Parse.UlistElementSyntaxTree),builder.setDescription(t("description.ulist")),builder.processNode(function(process,n){var node=n.toUlist();process.addSymbol({symbolName:"ul",node:node})})},DefaultAnalyzer.prototype.olist=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(ReVIEW.Parse.OlistElementSyntaxTree),builder.setDescription(t("description.olist")),builder.processNode(function(process,n){var node=n.toOlist();process.addSymbol({symbolName:"ol",node:node})})},DefaultAnalyzer.prototype.dlist=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(ReVIEW.Parse.DlistElementSyntaxTree),builder.setDescription(t("description.dlist")),builder.processNode(function(process,n){var node=n.toDlist();process.addSymbol({symbolName:"dl",node:node})})},DefaultAnalyzer.prototype.block_list=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("list"),builder.setDescription(t("description.block_list")),builder.checkArgsLength(2),builder.processNode(function(process,n){var node=n.toBlockElement();node.no=process.nextIndex("list"),process.addSymbol({symbolName:node.symbol,labelName:node.args[0].arg,node:node})})},DefaultAnalyzer.prototype.block_listnum=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("listnum"),builder.setDescription(t("description.block_listnum")),builder.checkArgsLength(2),builder.processNode(function(process,n){var node=n.toBlockElement();node.no=process.nextIndex("list"),process.addSymbol({symbolName:"list",labelName:node.args[0].arg,node:node})})},DefaultAnalyzer.prototype.inline_list=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("list"),builder.setDescription(t("description.inline_list")),builder.processNode(function(process,n){var node=n.toInlineElement();process.addSymbol({symbolName:node.symbol,referenceTo:process.constructReferenceTo(node,ReVIEW.nodeContentToString(process,node)),node:node})})},DefaultAnalyzer.prototype.block_emlist=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("emlist"),builder.setDescription(t("description.block_emlist")),builder.checkArgsLength(0,1),builder.processNode(function(process,n){var node=n.toBlockElement();process.addSymbol({symbolName:node.symbol,node:node})})},DefaultAnalyzer.prototype.block_emlistnum=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("emlistnum"),builder.setDescription(t("description.block_emlistnum")),builder.checkArgsLength(0),builder.processNode(function(process,n){var node=n.toBlockElement();process.addSymbol({symbolName:"emlist",node:node})})},DefaultAnalyzer.prototype.inline_hd=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("hd"),builder.setDescription(t("description.inline_hd")),builder.processNode(function(process,n){var node=n.toInlineElement();process.addSymbol({symbolName:node.symbol,referenceTo:process.constructReferenceTo(node,ReVIEW.nodeContentToString(process,node)),node:node})})},DefaultAnalyzer.prototype.block_image=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("image"),builder.setDescription(t("description.block_image")),builder.checkArgsLength(2,3),builder.processNode(function(process,n){var node=n.toBlockElement();node.no=process.nextIndex("image"),process.addSymbol({symbolName:node.symbol,labelName:node.args[0].arg,node:node})})},DefaultAnalyzer.prototype.block_indepimage=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("indepimage"),builder.setDescription(t("description.block_indepimage")),builder.checkArgsLength(1,2,3),builder.processNode(function(process,n){var node=n.toBlockElement();process.addSymbol({symbolName:node.symbol,node:node})})},DefaultAnalyzer.prototype.inline_img=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("img"),builder.setDescription(t("description.inline_img")),builder.processNode(function(process,n){var node=n.toInlineElement();process.addSymbol({symbolName:node.symbol,referenceTo:process.constructReferenceTo(node,ReVIEW.nodeContentToString(process,node),"image"),node:node})})},DefaultAnalyzer.prototype.inline_icon=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("icon"),builder.setDescription(t("description.inline_icon")),builder.processNode(function(process,n){var node=n.toInlineElement();
process.addSymbol({symbolName:node.symbol,node:node})})},DefaultAnalyzer.prototype.block_footnote=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("footnote"),builder.setDescription(t("description.block_footnote")),builder.checkArgsLength(2),builder.processNode(function(process,n){var node=n.toBlockElement();node.no=process.nextIndex("footnote"),process.addSymbol({symbolName:node.symbol,labelName:node.args[0].arg,node:node})})},DefaultAnalyzer.prototype.inline_fn=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("fn"),builder.setDescription(t("description.inline_fn")),builder.processNode(function(process,n){var node=n.toInlineElement();process.addSymbol({symbolName:node.symbol,referenceTo:process.constructReferenceTo(node,ReVIEW.nodeContentToString(process,node),"footnote"),node:node})})},DefaultAnalyzer.prototype.blockDecorationSyntax=function(builder,symbol){for(var argsLength=[],_i=0;_i<arguments.length-2;_i++)argsLength[_i]=arguments[_i+2];builder.setSyntaxType(SyntaxType.Block),builder.setSymbol(symbol),builder.setDescription(t("description.block_"+symbol)),builder.checkArgsLength.apply(builder,argsLength),builder.processNode(function(process,n){var node=n.toBlockElement();process.addSymbol({symbolName:node.symbol,node:node})})},DefaultAnalyzer.prototype.block_lead=function(builder){this.blockDecorationSyntax(builder,"lead",0),builder.setAllowFullySyntax(!0)},DefaultAnalyzer.prototype.block_noindent=function(builder){this.blockDecorationSyntax(builder,"noindent",0)},DefaultAnalyzer.prototype.block_source=function(builder){this.blockDecorationSyntax(builder,"source",1)},DefaultAnalyzer.prototype.block_cmd=function(builder){this.blockDecorationSyntax(builder,"cmd",0)},DefaultAnalyzer.prototype.block_quote=function(builder){this.blockDecorationSyntax(builder,"quote",0)},DefaultAnalyzer.prototype.inlineDecorationSyntax=function(builder,symbol){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol(symbol),builder.setDescription(t("description.inline_"+symbol)),builder.processNode(function(process,n){var node=n.toInlineElement();process.addSymbol({symbolName:node.symbol,node:node})})},DefaultAnalyzer.prototype.inline_br=function(builder){this.inlineDecorationSyntax(builder,"br")},DefaultAnalyzer.prototype.inline_ruby=function(builder){this.inlineDecorationSyntax(builder,"ruby")},DefaultAnalyzer.prototype.inline_b=function(builder){this.inlineDecorationSyntax(builder,"b")},DefaultAnalyzer.prototype.inline_code=function(builder){this.inlineDecorationSyntax(builder,"code")},DefaultAnalyzer.prototype.inline_tt=function(builder){this.inlineDecorationSyntax(builder,"tt")},DefaultAnalyzer.prototype.inline_href=function(builder){this.inlineDecorationSyntax(builder,"href")},DefaultAnalyzer.prototype.block_label=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("label"),builder.setDescription(t("description.block_label")),builder.checkArgsLength(1),builder.processNode(function(process,n){var node=n.toBlockElement();node.no=process.nextIndex("label"),process.addSymbol({symbolName:node.symbol,labelName:node.args[0].arg,node:node})})},DefaultAnalyzer.prototype.inline_u=function(builder){this.inlineDecorationSyntax(builder,"u")},DefaultAnalyzer.prototype.inline_kw=function(builder){this.inlineDecorationSyntax(builder,"kw")},DefaultAnalyzer.prototype.inline_em=function(builder){this.inlineDecorationSyntax(builder,"em")},DefaultAnalyzer.prototype.inline_tti=function(builder){this.inlineDecorationSyntax(builder,"tti")},DefaultAnalyzer.prototype.inline_ttb=function(builder){this.inlineDecorationSyntax(builder,"ttb")},DefaultAnalyzer.prototype.inline_ami=function(builder){this.inlineDecorationSyntax(builder,"ami")},DefaultAnalyzer.prototype.inline_bou=function(builder){this.inlineDecorationSyntax(builder,"bou")},DefaultAnalyzer.prototype.inline_i=function(builder){this.inlineDecorationSyntax(builder,"i")},DefaultAnalyzer.prototype.inline_strong=function(builder){this.inlineDecorationSyntax(builder,"strong")},DefaultAnalyzer.prototype.inline_uchar=function(builder){this.inlineDecorationSyntax(builder,"uchar")},DefaultAnalyzer}();Build.DefaultAnalyzer=DefaultAnalyzer}(ReVIEW.Build||(ReVIEW.Build={}));ReVIEW.Build}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(Build){var UlistElementSyntaxTree=(ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.NodeSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.UlistElementSyntaxTree),DefaultBuilder=(ReVIEW.Parse.OlistElementSyntaxTree,ReVIEW.Parse.DlistElementSyntaxTree,ReVIEW.Parse.TextNodeSyntaxTree,ReVIEW.Parse.ChapterSyntaxTree,function(){function DefaultBuilder(){}return Object.defineProperty(DefaultBuilder.prototype,"name",{get:function(){return this.constructor.name},enumerable:!0,configurable:!0}),DefaultBuilder.prototype.init=function(book){var _this=this;this.book=book,book.parts.forEach(function(part){part.chapters.forEach(function(chapter){var process=chapter.createBuilderProcess(_this);ReVIEW.visit(chapter.root,{visitDefaultPre:function(){},visitChapterPre:function(node){return _this.chapterPre(process,node)},visitChapterPost:function(node){return _this.chapterPost(process,node)},visitHeadlinePre:function(node){return _this.headlinePre(process,"hd",node)},visitHeadlinePost:function(node){return _this.headlinePost(process,"hd",node)},visitParagraphPre:function(node){return _this.paragraphPre(process,"p",node)},visitParagraphPost:function(node){return _this.paragraphPost(process,"p",node)},visitUlistPre:function(node){return _this.ulistPre(process,"ul",node)},visitUlistPost:function(node){return _this.ulistPost(process,"ul",node)},visitOlistPre:function(node){return _this.olistPre(process,"ol",node)},visitOlistPost:function(node){return _this.olistPost(process,"ol",node)},visitDlistPre:function(node){return _this.dlistPre(process,"dl",node)},visitDlistPost:function(node){return _this.dlistPost(process,"dl",node)},visitBlockElementPre:function(node){return _this.blockPre(process,node.symbol,node)},visitBlockElementPost:function(node){return _this.blockPost(process,node.symbol,node)},visitInlineElementPre:function(node){return _this.inlinePre(process,node.symbol,node)},visitInlineElementPost:function(node){return _this.inlinePost(process,node.symbol,node)},visitTextPre:function(node){_this.text(process,node)}}),_this.processPost(process,chapter)})}),book.parts.forEach(function(part){part.chapters.forEach(function(chapter){chapter.process.doAfterProcess()})})},DefaultBuilder.prototype.processPost=function(){},DefaultBuilder.prototype.chapterPre=function(){},DefaultBuilder.prototype.chapterPost=function(){},DefaultBuilder.prototype.headlinePre=function(){},DefaultBuilder.prototype.headlinePost=function(){},DefaultBuilder.prototype.paragraphPre=function(){},DefaultBuilder.prototype.paragraphPost=function(){},DefaultBuilder.prototype.ulistPre=function(){},DefaultBuilder.prototype.ulistPost=function(){},DefaultBuilder.prototype.olistPre=function(){},DefaultBuilder.prototype.olistPost=function(){},DefaultBuilder.prototype.dlistPre=function(){},DefaultBuilder.prototype.dlistPost=function(){},DefaultBuilder.prototype.text=function(process,node){process.out(node.text)},DefaultBuilder.prototype.blockPre=function(process,name,node){var func;if(func=this["block_"+name],"function"==typeof func)return func.call(this,process,node);if(func=this["block_"+name+"_pre"],"function"!=typeof func)throw new Build.AnalyzerError("block_"+name+"_pre or block_"+name+" is not Function");return func.call(this,process,node)},DefaultBuilder.prototype.blockPost=function(process,name,node){var func;if(func=this["block_"+name],"function"!=typeof func){if(func=this["block_"+name+"_post"],"function"!=typeof func)throw new Build.AnalyzerError("block_"+name+"_post is not Function");return func.call(this,process,node)}},DefaultBuilder.prototype.inlinePre=function(process,name,node){var func;if(func=this["inline_"+name],"function"==typeof func)return func.call(this,process,node);if(func=this["inline_"+name+"_pre"],"function"!=typeof func)throw new Build.AnalyzerError("inline_"+name+"_pre or inline_"+name+" is not Function");return func.call(this,process,node)},DefaultBuilder.prototype.inlinePost=function(process,name,node){var func;if(func=this["inline_"+name],"function"!=typeof func){if(func=this["inline_"+name+"_post"],"function"!=typeof func)throw new Build.AnalyzerError("inline_"+name+"_post is not Function");return func.call(this,process,node)}},DefaultBuilder.prototype.ulistParentHelper=function(process,node,action,currentLevel){if("undefined"==typeof currentLevel&&(currentLevel=node.level),1!==currentLevel){var result=ReVIEW.findUp(node.parentNode,function(n){if(n instanceof UlistElementSyntaxTree){var ulist=n.toUlist();return ulist.level===currentLevel-1}return!1});if(result)return;action(),this.ulistParentHelper(process,node,action,currentLevel-1)}},DefaultBuilder.prototype.findReference=function(process,node){var founds=process.symbols.filter(function(symbol){return symbol.node===node});if(1!==founds.length)throw new Build.AnalyzerError("invalid status.");return founds[0]},DefaultBuilder}());Build.DefaultBuilder=DefaultBuilder}(ReVIEW.Build||(ReVIEW.Build={}));ReVIEW.Build}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){var t=ReVIEW.i18n.t;!function(ReportLevel){ReportLevel[ReportLevel.Info=0]="Info",ReportLevel[ReportLevel.Warning=1]="Warning",ReportLevel[ReportLevel.Error=2]="Error"}(ReVIEW.ReportLevel||(ReVIEW.ReportLevel={}));var ReportLevel=ReVIEW.ReportLevel,ProcessReport=function(){function ProcessReport(level,part,chapter,message,nodes){"undefined"==typeof nodes&&(nodes=[]),this.level=level,this.part=part,this.chapter=chapter,this.message=message,this.nodes=nodes}return ProcessReport}();ReVIEW.ProcessReport=ProcessReport;var BookProcess=function(){function BookProcess(){this.reports=[]}return BookProcess.prototype.info=function(message){this.reports.push(new ProcessReport(ReportLevel.Info,null,null,message))},BookProcess.prototype.warn=function(message){this.reports.push(new ProcessReport(ReportLevel.Warning,null,null,message))},BookProcess.prototype.error=function(message){this.reports.push(new ProcessReport(ReportLevel.Error,null,null,message))},BookProcess}();ReVIEW.BookProcess=BookProcess;var Process=function(){function Process(part,chapter,input){this.part=part,this.chapter=chapter,this.input=input,this.symbols=[],this.indexCounter={},this.afterProcess=[],this._reports=[]}return Process.prototype.info=function(message){for(var nodes=[],_i=0;_i<arguments.length-1;_i++)nodes[_i]=arguments[_i+1];this._reports.push(new ProcessReport(ReportLevel.Info,this.part,this.chapter,message,nodes))},Process.prototype.warn=function(message){for(var nodes=[],_i=0;_i<arguments.length-1;_i++)nodes[_i]=arguments[_i+1];this._reports.push(new ProcessReport(ReportLevel.Warning,this.part,this.chapter,message,nodes))},Process.prototype.error=function(message){for(var nodes=[],_i=0;_i<arguments.length-1;_i++)nodes[_i]=arguments[_i+1];this._reports.push(new ProcessReport(ReportLevel.Error,this.part,this.chapter,message,nodes))},Process.prototype.nextIndex=function(kind){var nextIndex=this.indexCounter[kind];return"undefined"==typeof nextIndex?nextIndex=1:nextIndex++,this.indexCounter[kind]=nextIndex,nextIndex},Object.defineProperty(Process.prototype,"reports",{get:function(){return this._reports.sort(function(a,b){return 0===a.nodes.length&&0===b.nodes.length?0:0===a.nodes.length?-1:0===b.nodes.length?1:a.nodes[0].offset-b.nodes[0].offset})},enumerable:!0,configurable:!0}),Process.prototype.addSymbol=function(symbol){symbol.part=this.part,symbol.chapter=this.chapter,this.symbols.push(symbol)},Object.defineProperty(Process.prototype,"missingSymbols",{get:function(){var result=[];return this.symbols.forEach(function(symbol){symbol.referenceTo&&!symbol.referenceTo.referenceNode&&result.push(symbol)}),result},enumerable:!0,configurable:!0}),Process.prototype.constructReferenceTo=function(node,value,targetSymbol,separator){"undefined"==typeof targetSymbol&&(targetSymbol=node.symbol),"undefined"==typeof separator&&(separator="|");var splitted=value.split(separator);if(3===splitted.length)return{partName:splitted[0],chapterName:splitted[1],targetSymbol:targetSymbol,label:splitted[2]};if(2===splitted.length)return{part:this.part,partName:this.part.name,chapterName:splitted[0],targetSymbol:targetSymbol,label:splitted[1]};if(1===splitted.length)return{part:this.part,partName:this.part.name,chapter:this.chapter,chapterName:this.chapter.name,targetSymbol:targetSymbol,label:splitted[0]};var message=t("compile.args_length_mismatch","1 or 2 or 3",splitted.length);return this.error(message,node),null},Process.prototype.addAfterProcess=function(func){this.afterProcess.push(func)},Process.prototype.doAfterProcess=function(){this.afterProcess.forEach(function(func){return func()}),this.afterProcess=[]},Process}();ReVIEW.Process=Process;var BuilderProcess=function(){function BuilderProcess(builder,base){this.builder=builder,this.base=base,this.result=""}return Object.defineProperty(BuilderProcess.prototype,"info",{get:function(){return this.base.info.bind(this.base)},enumerable:!0,configurable:!0}),Object.defineProperty(BuilderProcess.prototype,"warn",{get:function(){return this.base.warn.bind(this.base)},enumerable:!0,configurable:!0}),Object.defineProperty(BuilderProcess.prototype,"error",{get:function(){return this.base.error.bind(this.base)},enumerable:!0,configurable:!0}),BuilderProcess.prototype.out=function(data){return this.result+=data,this},BuilderProcess.prototype.pushOut=function(data){return this.result=data+this.result,this},Object.defineProperty(BuilderProcess.prototype,"input",{get:function(){return this.base.input},enumerable:!0,configurable:!0}),Object.defineProperty(BuilderProcess.prototype,"symbols",{get:function(){return this.base.symbols},enumerable:!0,configurable:!0}),BuilderProcess}();ReVIEW.BuilderProcess=BuilderProcess;var Book=function(){function Book(config){this.config=config,this.process=new BookProcess,this.parts=[]}return Object.defineProperty(Book.prototype,"reports",{get:function(){var tmpArray=[];return tmpArray.push(this.process.reports),tmpArray.push(this.parts.map(function(part){return part.chapters.map(function(chapter){return chapter.process.reports})})),ReVIEW.flatten(tmpArray)},enumerable:!0,configurable:!0}),Book}();ReVIEW.Book=Book;var Part=function(){function Part(parent,no,name){this.parent=parent,this.no=no,this.name=name}return Part}();ReVIEW.Part=Part;var Chapter=function(){function Chapter(parent,no,name,input,root){this.parent=parent,this.no=no,this.name=name,this.input=input,this.root=root,this.builderProcesses=[],this.process=new Process(this.parent,this,input)}return Chapter.prototype.createBuilderProcess=function(builder){var builderProcess=new BuilderProcess(builder,this.process);return this.builderProcesses.push(builderProcess),builderProcess},Chapter.prototype.findResultByBuilder=function(builder){var founds;return founds="string"==typeof builder?this.builderProcesses.filter(function(process){return process.builder.name===builder}):this.builderProcesses.filter(function(process){return process.builder===builder}),founds[0].result},Chapter}();ReVIEW.Chapter=Chapter}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(Build){var TextNodeSyntaxTree=(ReVIEW.i18n.t,ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.NodeSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.TextNodeSyntaxTree),nodeContentToString=ReVIEW.nodeContentToString,SyntaxPreprocessor=function(){function SyntaxPreprocessor(){}return SyntaxPreprocessor.prototype.start=function(book,acceptableSyntaxes){this.acceptableSyntaxes=acceptableSyntaxes,this.preprocessBook(book)},SyntaxPreprocessor.prototype.preprocessBook=function(book){var _this=this;book.parts.forEach(function(part){return _this.preprocessPart(part)})},SyntaxPreprocessor.prototype.preprocessPart=function(part){var _this=this;part.chapters.forEach(function(chapter){return _this.preprocessChapter(chapter)})},SyntaxPreprocessor.prototype.preprocessChapter=function(chapter){var _this=this;ReVIEW.visit(chapter.root,{visitDefaultPre:function(){},visitBlockElementPre:function(node){_this.preprocessBlockSyntax(chapter,node)}})},SyntaxPreprocessor.prototype.preprocessBlockSyntax=function(chapter,node){if(0!==node.childNodes.length){var syntaxes=this.acceptableSyntaxes.find(node);if(1===syntaxes.length){var syntax=syntaxes[0];if(!syntax.allowFullySyntax)if(syntax.allowInline){var info,lastNode,resultNodes=[];if(node.childNodes.forEach(function(node){ReVIEW.visit(node,{visitDefaultPre:function(node){info||(info={offset:node.offset,line:node.line,column:node.column}),lastNode=node},visitInlineElementPre:function(node){var textNode=new TextNodeSyntaxTree({syntax:"BlockElementContentText",offset:info.offset,line:info.line,column:info.column,endPos:node.offset-1,text:chapter.process.input.substring(info.offset,node.offset-1)});resultNodes.push(textNode),resultNodes.push(node),info=null,lastNode=node}})}),info){var textNode=new TextNodeSyntaxTree({syntax:"BlockElementContentText",offset:info.offset,line:info.line,column:info.column,endPos:lastNode.endPos,text:chapter.process.input.substring(info.offset,lastNode.endPos)});resultNodes.push(textNode)}node.childNodes=resultNodes}else{var first=node.childNodes[0],last=node.childNodes[node.childNodes.length-1],textNode=new TextNodeSyntaxTree({syntax:"BlockElementContentText",offset:first.offset,line:first.line,column:first.column,endPos:last.endPos,text:nodeContentToString(chapter.process,node)});node.childNodes=[textNode]}}}},SyntaxPreprocessor}();Build.SyntaxPreprocessor=SyntaxPreprocessor}(ReVIEW.Build||(ReVIEW.Build={}));ReVIEW.Build}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(Build){var t=ReVIEW.i18n.t,DefaultValidator=(ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.ChapterSyntaxTree,ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.ArgumentSyntaxTree,function(){function DefaultValidator(){}return DefaultValidator.prototype.start=function(book,acceptableSyntaxes,builders){this.acceptableSyntaxes=acceptableSyntaxes,this.builders=builders,this.checkBuilder(book,acceptableSyntaxes,builders),this.checkBook(book),this.resolveSymbolAndReference(book)},DefaultValidator.prototype.checkBuilder=function(book,acceptableSyntaxes,builders){"undefined"==typeof builders&&(builders=[]),acceptableSyntaxes.acceptableSyntaxes.forEach(function(syntax){var prefix;switch(syntax.type){case Build.SyntaxType.Other:return;case Build.SyntaxType.Block:prefix="block_";break;case Build.SyntaxType.Inline:prefix="inline_"}var funcName1=prefix+syntax.symbolName,funcName2=prefix+syntax.symbolName+"_pre";builders.forEach(function(builder){var func=builder[funcName1]||builder[funcName2];func||book.process.error(Build.SyntaxType[syntax.type]+" "+syntax.symbolName+" is not supported in "+builder.name)})})},DefaultValidator.prototype.checkBook=function(book){var _this=this;book.parts.forEach(function(part){return _this.checkPart(part)})},DefaultValidator.prototype.checkPart=function(part){var _this=this;part.chapters.forEach(function(chapter){return _this.checkChapter(chapter)})},DefaultValidator.prototype.checkChapter=function(chapter){var _this=this;ReVIEW.visit(chapter.root,{visitDefaultPre:function(){},visitHeadlinePre:function(node){var results=_this.acceptableSyntaxes.find(node);return 1!==results.length?(chapter.process.error(t("compile.syntax_definietion_error"),node),void 0):results[0].process(chapter.process,node)},visitBlockElementPre:function(node){var results=_this.acceptableSyntaxes.find(node);if(1!==results.length)return chapter.process.error(t("compile.block_not_supported",node.symbol),node),void 0;var expects=results[0].argsLength,arg=node.args||[];if(-1===expects.indexOf(arg.length)){var expected=expects.map(function(n){return Number(n).toString()}).join(" or "),message=t("compile.args_length_mismatch",expected,arg.length);return chapter.process.error(message,node),void 0}return results[0].process(chapter.process,node)},visitInlineElementPre:function(node){var results=_this.acceptableSyntaxes.find(node);return 1!==results.length?(chapter.process.error(t("compile.inline_not_supported",node.symbol),node),void 0):results[0].process(chapter.process,node)}}),ReVIEW.visit(chapter.root,{visitDefaultPre:function(){},visitChapterPre:function(node){if(1===node.level)ReVIEW.findChapter(node)||chapter.process.error(t("compile.chapter_not_toplevel"),node);else{var parent=ReVIEW.findChapter(node.parentNode);parent?parent.level!==node.level-1&&chapter.process.error(t("compile.chapter_level_omission",node.level,node.level-1,parent?String(parent.level):"none"),node):chapter.process.error(t("compile.chapter_topleve_eq1"),node)}}})},DefaultValidator.prototype.resolveSymbolAndReference=function(book){var symbols=ReVIEW.flatten(book.parts.map(function(part){return part.chapters.map(function(chapter){return chapter.process.symbols})}));symbols.forEach(function(symbol){var referenceTo=symbol.referenceTo;if(referenceTo)return referenceTo.part||book.parts.forEach(function(part){referenceTo.partName===part.name&&(referenceTo.part=part)}),referenceTo.part?(referenceTo.chapter||referenceTo.part.chapters.forEach(function(chap){referenceTo.chapterName===chap.name&&(referenceTo.chapter=chap)}),referenceTo.chapter?void 0:(symbol.chapter.process.error(t("compile.chapter_is_missing",symbol.chapter.name),symbol.node),void 0)):(symbol.chapter.process.error(t("compile.part_is_missing",symbol.part.name),symbol.node),void 0)}),symbols.forEach(function(symbol){if(symbol.referenceTo&&!symbol.referenceTo.referenceNode){var reference=symbol.referenceTo;if(symbols.forEach(function(symbol){reference.part===symbol.part&&reference.chapter===symbol.chapter&&reference.targetSymbol===symbol.symbolName&&reference.label===symbol.labelName&&(reference.referenceNode=symbol.node)}),!reference.referenceNode)return symbol.chapter.process.error(t("compile.reference_is_missing",reference.targetSymbol,reference.label),symbol.node),void 0}}),symbols.forEach(function(symbol1){symbols.forEach(function(symbol2){return symbol1!==symbol2?symbol1.chapter===symbol2.chapter&&symbol1.symbolName===symbol2.symbolName&&symbol1.labelName&&symbol2.labelName&&symbol1.labelName===symbol2.labelName?(symbol1.chapter.process.error(t("compile.duplicated_label"),symbol1.node,symbol2.node),void 0):void 0:void 0})})},DefaultValidator}());Build.DefaultValidator=DefaultValidator}(ReVIEW.Build||(ReVIEW.Build={}));ReVIEW.Build}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){var t=ReVIEW.i18n.t,SyntaxTree=ReVIEW.Parse.SyntaxTree,flatten=(ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.TextNodeSyntaxTree,ReVIEW.Parse.ChapterSyntaxTree,ReVIEW.flatten),Controller=function(){function Controller(options){"undefined"==typeof options&&(options={}),this.options=options}return Controller.prototype.initConfig=function(data){this.config=ReVIEW.isNodeJS()?new NodeJSConfig(this.options,data):new WebBrowserConfig(this.options,data)},Controller.prototype.process=function(){var _this=this,acceptableSyntaxes=this.config.analyzer.getAcceptableSyntaxes();if(this.config.listener.onAcceptables(acceptableSyntaxes)===!1)return this.config.listener.onCompileFailed(),null;var book=this.processBook(),preprocessor=new ReVIEW.Build.SyntaxPreprocessor;if(preprocessor.start(book,acceptableSyntaxes),this.config.validators.forEach(function(validator){validator.start(book,acceptableSyntaxes,_this.config.builders)}),book.reports.some(function(report){return report.level===ReVIEW.ReportLevel.Error}))return this.config.listener.onReports(book.reports),this.config.listener.onCompileFailed(),book;var symbols=flatten(book.parts.map(function(part){return part.chapters.map(function(chapter){return chapter.process.symbols})}));return this.config.listener.onSymbols(symbols)===!1?(this.config.listener.onReports(book.reports),this.config.listener.onCompileFailed(),null):(this.config.builders.forEach(function(builder){return builder.init(book)}),this.config.listener.onReports(book.reports),this.config.listener.onCompileSuccess(book),book)},Controller.prototype.processBook=function(){var _this=this,book=new ReVIEW.Book(this.config);return book.parts=Object.keys(this.config.book).map(function(key,index){var chapters=_this.config.book[key];return _this.processPart(book,index,key,chapters)}),book.parts.forEach(function(part){var chapters=[];part.chapters.forEach(function(chapter){ReVIEW.visit(chapter.root,{visitDefaultPre:function(){},visitChapterPre:function(node){chapters.push(node)}})});var counter={},max=0,currentLevel=0;chapters.forEach(function(chapter){var level=chapter.headline.level;if(max=Math.max(max,level),currentLevel>level)for(var i=level+1;max>=i;i++)counter[i]=0;else if(level>currentLevel)for(var i=level;max>=i;i++)counter[i]=0;currentLevel=level,counter[level]+=1,chapter.no=counter[level]})}),book},Controller.prototype.processPart=function(book,index,name,chapters){"undefined"==typeof chapters&&(chapters=[]);var _this=this,part=new ReVIEW.Part(book,index+1,name);return part.chapters=chapters.map(function(chapter,index){return _this.processChapter(book,part,index,chapter)}),part},Controller.prototype.processChapter=function(book,part,index,chapterPath){var resolvedPath=this.config.resolvePath(chapterPath),data=this.config.read(resolvedPath);if(!data){var chapter=new ReVIEW.Chapter(part,index+1,chapterPath,data,null);return chapter.process.error(t("compile.file_not_exists",resolvedPath)),chapter}try{var parseResult=ReVIEW.Parse.parse(data),chapter=new ReVIEW.Chapter(part,index+1,chapterPath,data,parseResult.ast)}catch(e){if(!(e instanceof PEG.SyntaxError))throw e;var se=e,errorNode=new SyntaxTree({syntax:se.name,line:se.line,column:se.column,offset:se.offset,endPos:-1}),chapter=new ReVIEW.Chapter(part,index+1,chapterPath,data,null);chapter.process.error(se.message,errorNode)}return chapter},Controller}();ReVIEW.Controller=Controller;var ConfigWrapper=function(){function ConfigWrapper(original){this.original=original}return Object.defineProperty(ConfigWrapper.prototype,"read",{get:function(){throw new Error("please implements this method")},enumerable:!0,configurable:!0}),Object.defineProperty(ConfigWrapper.prototype,"write",{get:function(){throw new Error("please implements this method")},enumerable:!0,configurable:!0}),Object.defineProperty(ConfigWrapper.prototype,"analyzer",{get:function(){return this.original.analyzer||new ReVIEW.Build.DefaultAnalyzer},enumerable:!0,configurable:!0}),Object.defineProperty(ConfigWrapper.prototype,"validators",{get:function(){var config=this.original;return config.validators&&0!==config.validators.length?Array.isArray(config.validators)?config.validators:[config.validators]:[new ReVIEW.Build.DefaultValidator]},enumerable:!0,configurable:!0}),Object.defineProperty(ConfigWrapper.prototype,"builders",{get:function(){if(this._builders)return this._builders;var config=this.original;return this._builders=config.builders&&0!==config.builders.length?Array.isArray(config.builders)?config.builders:[config.builders]:[new ReVIEW.Build.DefaultBuilder],this._builders},enumerable:!0,configurable:!0}),Object.defineProperty(ConfigWrapper.prototype,"listener",{get:function(){throw new Error("please implements this method")},enumerable:!0,configurable:!0}),Object.defineProperty(ConfigWrapper.prototype,"book",{get:function(){return this.original.book},enumerable:!0,configurable:!0}),ConfigWrapper.prototype.resolvePath=function(){throw new Error("please implements this method")},ConfigWrapper}(),NodeJSConfig=function(_super){function NodeJSConfig(options,original){_super.call(this,original),this.options=options,this.original=original}return __extends(NodeJSConfig,_super),Object.defineProperty(NodeJSConfig.prototype,"read",{get:function(){return this.original.read||ReVIEW.IO.read},enumerable:!0,configurable:!0}),Object.defineProperty(NodeJSConfig.prototype,"write",{get:function(){return this.original.write||ReVIEW.IO.write},enumerable:!0,configurable:!0}),Object.defineProperty(NodeJSConfig.prototype,"listener",{get:function(){if(this._listener)return this._listener;var listener=this.original.listener||{};return listener.onAcceptables=listener.onAcceptables||function(){},listener.onSymbols=listener.onSymbols||function(){},listener.onReports=listener.onReports||this.onReports,listener.onCompileSuccess=listener.onCompileSuccess||this.onCompileSuccess,listener.onCompileFailed=listener.onCompileFailed||this.onCompileFailed,this._listener=listener,this._listener},enumerable:!0,configurable:!0}),NodeJSConfig.prototype.onReports=function(reports){var colors=require("colors");colors.setTheme({info:"cyan",warn:"yellow",error:"red"}),reports.forEach(function(report){var message="";if(report.chapter&&(message+=report.chapter.name+" "),report.nodes&&report.nodes.forEach(function(node){message+="["+node.line+","+node.column+"] "}),message+=report.message,report.level===ReVIEW.ReportLevel.Error)console.warn(message.error);else if(report.level===ReVIEW.ReportLevel.Warning)console.error(message.warn);else{if(report.level!==ReVIEW.ReportLevel.Info)throw new Error("unknown report level.");console.info(message.info)}})},NodeJSConfig.prototype.onCompileSuccess=function(){process.exit(0)},NodeJSConfig.prototype.onCompileFailed=function(){process.exit(1)},NodeJSConfig.prototype.resolvePath=function(path){var p=require("path"),base=this.options.base||"./";return p.join(base,path)},NodeJSConfig}(ConfigWrapper),WebBrowserConfig=function(_super){function WebBrowserConfig(options,original){_super.call(this,original),this.options=options,this.original=original}return __extends(WebBrowserConfig,_super),Object.defineProperty(WebBrowserConfig.prototype,"read",{get:function(){return this.original.read||function(){throw new Error("please implement config.read method")}},enumerable:!0,configurable:!0}),Object.defineProperty(WebBrowserConfig.prototype,"write",{get:function(){return this.original.write||function(){throw new Error("please implement config.write method")}},enumerable:!0,configurable:!0}),Object.defineProperty(WebBrowserConfig.prototype,"listener",{get:function(){if(this._listener)return this._listener;var listener=this.original.listener||{};return listener.onAcceptables=listener.onAcceptables||function(){},listener.onSymbols=listener.onSymbols||function(){},listener.onReports=listener.onReports||this.onReports,listener.onCompileSuccess=listener.onCompileSuccess||this.onCompileSuccess,listener.onCompileFailed=listener.onCompileFailed||this.onCompileFailed,this._listener=listener,this._listener},enumerable:!0,configurable:!0}),WebBrowserConfig.prototype.onReports=function(reports){reports.forEach(function(report){var message="";if(report.chapter&&(message+=report.chapter.name+" "),report.nodes&&report.nodes.forEach(function(node){message+="["+node.line+","+node.column+"] "}),message+=report.message,report.level===ReVIEW.ReportLevel.Error)console.warn(message);else if(report.level===ReVIEW.ReportLevel.Warning)console.error(message);else{if(report.level!==ReVIEW.ReportLevel.Info)throw new Error("unknown report level.");console.info(message)}})},WebBrowserConfig.prototype.onCompileSuccess=function(){},WebBrowserConfig.prototype.onCompileFailed=function(){},WebBrowserConfig.prototype.resolvePath=function(path){if(!this.options.base)return path;var base=this.options.base;return this.endWith(base,"/")||this.startWith(path,"/")||(base+="/"),base+path},WebBrowserConfig.prototype.startWith=function(str,target){return 0===str.indexOf(target)},WebBrowserConfig.prototype.endWith=function(str,target){return-1!==str.indexOf(target,str.length-target.length)},WebBrowserConfig}(ConfigWrapper)}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(Build){var t=ReVIEW.i18n.t,UlistElementSyntaxTree=(ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.NodeSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.UlistElementSyntaxTree),nodeContentToString=(ReVIEW.Parse.OlistElementSyntaxTree,ReVIEW.Parse.DlistElementSyntaxTree,ReVIEW.Parse.TextNodeSyntaxTree,ReVIEW.Parse.ChapterSyntaxTree,ReVIEW.nodeContentToString),findChapter=ReVIEW.findChapter,TextBuilder=function(_super){function TextBuilder(){_super.apply(this,arguments)
}return __extends(TextBuilder,_super),TextBuilder.prototype.chapterPost=function(process,node){node.headline.cmd&&process.out("ââçµäº:ââ\n")},TextBuilder.prototype.headlinePre=function(process,name,node){if(node.cmd)return process.out("ââéå§:ââ\n"),process.out("â "),function(v){ReVIEW.visit(node.caption,v)};if(process.out("â H").out(node.level).out("â "),1===node.level){var text=ReVIEW.i18n.t("builder.chapter",node.parentNode.no);process.out(text).out("ã")}else 2===node.level&&process.out(node.parentNode.toChapter().fqn).out("ã")},TextBuilder.prototype.headlinePost=function(process){process.out("\n\n")},TextBuilder.prototype.paragraphPost=function(process){process.out("\n")},TextBuilder.prototype.ulistPre=function(process,name,node){this.ulistParentHelper(process,node,function(){process.out("\n\nâ	")}),node.parentNode instanceof UlistElementSyntaxTree&&node.prev instanceof UlistElementSyntaxTree==!1?process.out("\n\n"):node.parentNode instanceof UlistElementSyntaxTree&&process.out(""),process.out("â	")},TextBuilder.prototype.ulistPost=function(process){process.out("\n")},TextBuilder.prototype.olistPre=function(process,name,node){process.out(node.no).out("	")},TextBuilder.prototype.olistPost=function(process){process.out("\n")},TextBuilder.prototype.dlistPre=function(process,name,node){return function(v){process.out("â"),ReVIEW.visit(node.text,v),process.out("â\n"),process.out("	"),ReVIEW.visit(node.content,v),process.out("\n")}},TextBuilder.prototype.dlistPost=function(process){process.out("\n")},TextBuilder.prototype.block_list_pre=function(process,node){process.out("ââéå§:ãªã¹ãââ\n");var chapter=findChapter(node,1),text=ReVIEW.i18n.t("builder.list",chapter.fqn,node.no);return process.out(text).out("ã").out(node.args[1].arg).out("\n\n"),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_list_post=function(process){process.out("\nââçµäº:ãªã¹ãââ\n")},TextBuilder.prototype.block_listnum_pre=function(process,node){process.out("ââéå§:ãªã¹ãââ\n");var chapter=findChapter(node,1),text=ReVIEW.i18n.t("builder.list",chapter.fqn,node.no);process.out(text).out("ã").out(node.args[1].arg).out("\n\n");var lineCount=1;return function(v){node.childNodes.forEach(function(node,index,childNodes){if(node.isTextNode()){var hasNext=!!childNodes[index+1],textNode=node.toTextNode(),lines=textNode.text.split("\n");lines.forEach(function(line,index){process.out(" ").out(lineCount).out(": "),process.out(line),hasNext&&lines.length-1===index||lineCount++,process.out("\n")})}else ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_listnum_post=function(process){process.out("ââçµäº:ãªã¹ãââ\n")},TextBuilder.prototype.inline_list=function(process,node){var chapter=findChapter(node,1),listNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),text=ReVIEW.i18n.t("builder.list",chapter.fqn,listNode.no);return process.out(text),!1},TextBuilder.prototype.block_emlist_pre=function(process,node){return process.out("ââéå§:ã¤ã³ã©ã¤ã³ãªã¹ãââ\n"),node.args[0]&&process.out("â ").out("").out(node.args[0].arg).out("\n"),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_emlist_post=function(process){process.out("\nââçµäº:ã¤ã³ã©ã¤ã³ãªã¹ãââ\n")},TextBuilder.prototype.block_emlistnum_pre=function(process,node){process.out("ââéå§:ã¤ã³ã©ã¤ã³ãªã¹ãââ\n"),node.args[0]&&process.out("â ").out("").out(node.args[0].arg).out("\n");var lineCount=1;return function(v){node.childNodes.forEach(function(node,index,childNodes){if(node.isTextNode()){var hasNext=!!childNodes[index+1],textNode=node.toTextNode(),lines=textNode.text.split("\n");lines.forEach(function(line,index){process.out(" ").out(lineCount).out(": "),process.out(line),hasNext&&lines.length-1===index||lineCount++,process.out("\n")})}else ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_emlistnum_post=function(process){process.out("ââçµäº:ã¤ã³ã©ã¤ã³ãªã¹ãââ\n")},TextBuilder.prototype.inline_hd_pre=function(process,node){process.out("ã");var chapter=findChapter(node);return 1===chapter.level?process.out(chapter.fqn).out("ç«  "):process.out(chapter.fqn).out(" "),process.out(nodeContentToString(process,chapter.headline)),!1},TextBuilder.prototype.inline_hd_post=function(process){process.out("ã")},TextBuilder.prototype.inline_br=function(process){process.out("\n")},TextBuilder.prototype.inline_b_pre=function(process){process.out("â")},TextBuilder.prototype.inline_b_post=function(process){process.out("â")},TextBuilder.prototype.inline_code_pre=function(process){process.out("â³")},TextBuilder.prototype.inline_code_post=function(process){process.out("â")},TextBuilder.prototype.inline_href_pre=function(process){process.out("â³")},TextBuilder.prototype.inline_href_post=function(process){process.out("â")},TextBuilder.prototype.inline_href=function(process,node){var href=null,text=nodeContentToString(process,node);return-1!==text.indexOf(",")&&(href=text.slice(0,text.indexOf(",")),text=text.slice(text.indexOf(",")+1).trimLeft()),href?process.out(text).out("ï¼â³").out(href).out("âï¼"):process.out("â³").out(text).out("â"),!1},TextBuilder.prototype.block_label=function(){return!1},TextBuilder.prototype.inline_ruby=function(process,node){var contentString=nodeContentToString(process,node),keywordData=contentString.split(",");return process.out(keywordData[0]),function(){node.childNodes.forEach(function(){process.out("ââDTPé£çµ¡:ã").out(keywordData[0]),process.out("ãã«ã ").out(keywordData[1].trim()).out("ãã¨ã«ãââ")})}},TextBuilder.prototype.inline_u_pre=function(process){process.out("ï¼ ")},TextBuilder.prototype.inline_u_post=function(process){process.out("ï¼ ââï¼ ãï¼ é¨åã«ä¸ç·ââ")},TextBuilder.prototype.inline_kw=function(process,node){return process.out("â"),function(){node.childNodes.forEach(function(node){var contentString=nodeContentToString(process,node),keywordData=contentString.split(",");process.out(keywordData[0]+"âï¼"+keywordData[1].trimLeft()+"ï¼")})}},TextBuilder.prototype.inline_tt_pre=function(process){process.out("â³")},TextBuilder.prototype.inline_tt_post=function(process){process.out("â")},TextBuilder.prototype.inline_em_pre=function(process,node){process.warn(t("compile.deprecated_inline_symbol","em"),node),process.out("@<em>{")},TextBuilder.prototype.inline_em_post=function(process){process.out("}")},TextBuilder.prototype.block_image=function(process,node){var chapterFileName=process.base.chapter.name,chapterName=chapterFileName.substring(0,chapterFileName.length-3),imagePath="./images/"+chapterName+"-"+node.args[0].arg+".png",caption=node.args[1].arg;return process.out("ââéå§:å³ââ\n"),process.out("å³").out(process.base.chapter.no).out(".").out(node.no).out("ã").out(caption).out("\n"),process.out("\n"),process.out("ââ").out(imagePath).out("ââ\n"),process.out("ââçµäº:å³ââ\n"),!1},TextBuilder.prototype.block_indepimage=function(process,node){return process.out("ââç»å ").out(node.args[0].arg).out("ââ\n"),node.args[1]&&process.out("å³ã").out(node.args[1].arg).out("\n\n"),!1},TextBuilder.prototype.inline_img=function(process,node){var imgNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out("å³").out(process.base.chapter.no).out(".").out(imgNode.no).out("\n"),!1},TextBuilder.prototype.inline_icon=function(process,node){var chapterFileName=process.base.chapter.name,chapterName=chapterFileName.substring(0,chapterFileName.length-3),imageName=nodeContentToString(process,node),imagePath="images/"+chapterName+"-"+imageName+".png";return process.out("ââç»å ").out(imagePath).out("ââ"),!1},TextBuilder.prototype.block_footnote=function(process,node){return process.out("ãæ³¨").out(node.no).out("ã").out(node.args[1].arg).out("\n"),!1},TextBuilder.prototype.inline_fn=function(process,node){var footnoteNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out("ãæ³¨").out(footnoteNode.no).out("ã"),!1},TextBuilder.prototype.block_lead_pre=function(process){process.out("ââéå§:ãªã¼ãââ\n")},TextBuilder.prototype.block_lead_post=function(process){process.out("ââçµäº:ãªã¼ãââ\n")},TextBuilder.prototype.inline_tti_pre=function(process){process.out("â²")},TextBuilder.prototype.inline_tti_post=function(process){process.out("âââç­å¹ãã©ã³ãã¤ã¿ââ")},TextBuilder.prototype.inline_ttb_pre=function(process){process.out("â")},TextBuilder.prototype.inline_ttb_post=function(process){process.out("âââç­å¹ãã©ã³ãå¤ªå­ââ")},TextBuilder.prototype.block_noindent=function(process){return process.out("ââDTPé£çµ¡:æ¬¡ã®1è¡ã¤ã³ãã³ããªãââ\n"),!1},TextBuilder.prototype.block_source_pre=function(process,node){return process.out("ââéå§:ã½ã¼ã¹ã³ã¼ããªã¹ãââ\n"),process.out("â ").out(node.args[0].arg).out("\n"),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_source_post=function(process){process.out("\nââçµäº:ã½ã¼ã¹ã³ã¼ããªã¹ãââ\n")},TextBuilder.prototype.block_cmd_pre=function(process,node){return process.out("ââéå§:ã³ãã³ãââ\n"),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_cmd_post=function(process){process.out("\nââçµäº:ã³ãã³ãââ\n")},TextBuilder.prototype.block_quote_pre=function(process,node){return process.out("ââéå§:å¼ç¨ââ\n"),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},TextBuilder.prototype.block_quote_post=function(process){process.out("\nââçµäº:å¼ç¨ââ\n")},TextBuilder.prototype.inline_ami_pre=function(){},TextBuilder.prototype.inline_ami_post=function(process,node){process.out("ââDTPé£çµ¡:ã").out(nodeContentToString(process,node)).out("ãã«ç¶²ã«ã±ââ")},TextBuilder.prototype.inline_bou_pre=function(){},TextBuilder.prototype.inline_bou_post=function(process,node){process.out("ââDTPé£çµ¡:ã").out(nodeContentToString(process,node)).out("ãã«åç¹ââ")},TextBuilder.prototype.inline_i_pre=function(process){process.out("â²")},TextBuilder.prototype.inline_i_post=function(process){process.out("â")},TextBuilder.prototype.inline_strong_pre=function(process){process.out("â")},TextBuilder.prototype.inline_strong_post=function(process){process.out("â")},TextBuilder.prototype.inline_uchar=function(process,node){for(var hexString=nodeContentToString(process,node),code=parseInt(hexString,16),result="";0!==code;)result=String.fromCharCode(65535&code)+result,code>>>=16;return process.out(result),!1},TextBuilder}(Build.DefaultBuilder);Build.TextBuilder=TextBuilder}(ReVIEW.Build||(ReVIEW.Build={}));ReVIEW.Build}(ReVIEW||(ReVIEW={}));var ReVIEW;!function(ReVIEW){!function(Build){var i18n=ReVIEW.i18n,UlistElementSyntaxTree=(ReVIEW.Parse.SyntaxTree,ReVIEW.Parse.NodeSyntaxTree,ReVIEW.Parse.BlockElementSyntaxTree,ReVIEW.Parse.InlineElementSyntaxTree,ReVIEW.Parse.HeadlineSyntaxTree,ReVIEW.Parse.UlistElementSyntaxTree),OlistElementSyntaxTree=ReVIEW.Parse.OlistElementSyntaxTree,DlistElementSyntaxTree=ReVIEW.Parse.DlistElementSyntaxTree,nodeContentToString=(ReVIEW.Parse.TextNodeSyntaxTree,ReVIEW.Parse.ChapterSyntaxTree,ReVIEW.nodeContentToString),findChapter=ReVIEW.findChapter,HtmlBuilder=(ReVIEW.findUp,function(_super){function HtmlBuilder(standalone){"undefined"==typeof standalone&&(standalone=!0),_super.call(this),this.standalone=standalone}return __extends(HtmlBuilder,_super),HtmlBuilder.prototype.processPost=function(process,chapter){if(this.standalone){var pre="";pre+='<?xml version="1.0" encoding="UTF-8"?>\n',pre+='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n',pre+='<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="ja">\n',pre+="<head>\n",pre+='  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />\n',pre+='  <meta http-equiv="Content-Style-Type" content="text/css" />\n',pre+='  <meta name="generator" content="ReVIEW" />\n';var name=null;ReVIEW.visit(chapter.root,{visitDefaultPre:function(){},visitChapterPre:function(node){name=nodeContentToString(process,node.headline.caption)}}),pre+="  <title>"+name+"</title>\n",pre+="</head>\n",pre+="<body>\n",process.pushOut(pre),process.out("</body>\n"),process.out("</html>\n")}},HtmlBuilder.prototype.headlinePre=function(process,name,node){if(node.cmd&&process.out('<div class="column">\n'),process.out("<h").out(node.level),node.label&&process.out(' id="').out(node.label.arg).out('"'),process.out(">"),node.cmd?process.out('<a id="column-').out(node.parentNode.no).out('"></a>'):process.out('<a id="h').out(node.level).out('"></a>'),node.cmd)return function(v){ReVIEW.visit(node.caption,v)};if(1===node.level){var text=i18n.t("builder.chapter",node.parentNode.no);process.out(text).out("ã")}else 2===node.level&&process.out(node.parentNode.toChapter().fqn).out("ã")},HtmlBuilder.prototype.headlinePost=function(process,name,node){process.out("</h").out(node.level).out(">\n"),node.cmd&&process.out("</div>\n")},HtmlBuilder.prototype.paragraphPre=function(process,name,node){node.prev&&node.prev.isBlockElement()&&"noindent"===node.prev.toBlockElement().symbol?process.out('<p class="noindent">'):process.out("<p>")},HtmlBuilder.prototype.paragraphPost=function(process){process.out("</p>\n")},HtmlBuilder.prototype.ulistPre=function(process,name,node){this.ulistParentHelper(process,node,function(){process.out("<ul>\n<li>")}),node.prev instanceof UlistElementSyntaxTree==!1&&process.out("<ul>\n"),process.out("<li>")},HtmlBuilder.prototype.ulistPost=function(process,name,node){process.out("</li>\n"),node.next instanceof UlistElementSyntaxTree==!1&&process.out("</ul>\n"),this.ulistParentHelper(process,node,function(){process.out("</li>\n</ul>\n")})},HtmlBuilder.prototype.olistPre=function(process,name,node){node.prev instanceof OlistElementSyntaxTree==!1&&process.out("<ol>\n"),process.out("<li>")},HtmlBuilder.prototype.olistPost=function(process,name,node){process.out("</li>\n"),node.next instanceof OlistElementSyntaxTree==!1&&process.out("</ol>\n")},HtmlBuilder.prototype.dlistPre=function(process,name,node){return node.prev instanceof DlistElementSyntaxTree==!1&&process.out("<dl>\n"),function(v){process.out("<dt>"),ReVIEW.visit(node.text,v),process.out("</dt>\n"),process.out("<dd>"),ReVIEW.visit(node.content,v),process.out("</dd>\n")}},HtmlBuilder.prototype.dlistPost=function(process,name,node){node.next instanceof DlistElementSyntaxTree==!1&&process.out("</dl>\n")},HtmlBuilder.prototype.block_list_pre=function(process,node){process.out('<div class="caption-code">\n');var chapter=findChapter(node,1),text=i18n.t("builder.list",chapter.fqn,node.no);return process.out('<p class="caption">').out(text).out(": ").out(node.args[1].arg).out("</p>\n"),process.out('<pre class="list">'),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_list_post=function(process){process.out("\n</pre>\n").out("</div>\n")},HtmlBuilder.prototype.block_listnum_pre=function(process,node){process.out('<div class="code">\n');var chapter=findChapter(node,1),text=i18n.t("builder.list",chapter.fqn,node.no);process.out('<p class="caption">').out(text).out(": ").out(node.args[1].arg).out("</p>\n"),process.out('<pre class="list">');var lineCount=1;return function(v){node.childNodes.forEach(function(node,index,childNodes){if(node.isTextNode()){var hasNext=!!childNodes[index+1],textNode=node.toTextNode(),lines=textNode.text.split("\n");lines.forEach(function(line,index){process.out(" ").out(lineCount).out(": "),process.out(line),hasNext&&lines.length-1===index||lineCount++,lines.length-1!==index&&process.out("\n")})}else ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_listnum_post=function(process){process.out("\n</pre>\n").out("</div>\n")},HtmlBuilder.prototype.inline_list=function(process,node){var chapter=findChapter(node,1),listNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),text=i18n.t("builder.list",chapter.fqn,listNode.no);return process.out(text),!1},HtmlBuilder.prototype.block_emlist_pre=function(process,node){return process.out('<div class="emlist-code">\n'),node.args[0]&&process.out('<p class="caption">').out(node.args[0].arg).out("</p>\n"),process.out('<pre class="emlist">'),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_emlist_post=function(process){process.out("\n</pre>\n").out("</div>\n")},HtmlBuilder.prototype.block_emlistnum_pre=function(process,node){process.out('<div class="emlistnum-code">\n'),process.out('<pre class="emlist">');var lineCount=1;return function(v){node.childNodes.forEach(function(node,index,childNodes){if(node.isTextNode()){var hasNext=!!childNodes[index+1],textNode=node.toTextNode(),lines=textNode.text.split("\n");lines.forEach(function(line,index){process.out(" ").out(lineCount).out(": "),process.out(line),hasNext&&lines.length-1===index||lineCount++,lines.length-1!==index&&process.out("\n")})}else ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_emlistnum_post=function(process){process.out("\n</pre>\n").out("</div>\n")},HtmlBuilder.prototype.inline_hd_pre=function(process,node){process.out("ã");var chapter=findChapter(node);return 1===chapter.level?process.out(chapter.fqn).out("ç«  "):process.out(chapter.fqn).out(" "),process.out(nodeContentToString(process,chapter.headline)),!1},HtmlBuilder.prototype.inline_hd_post=function(process){process.out("ã")},HtmlBuilder.prototype.inline_br=function(process){process.out("<br />")},HtmlBuilder.prototype.inline_b_pre=function(process){process.out("<b>")},HtmlBuilder.prototype.inline_b_post=function(process){process.out("</b>")},HtmlBuilder.prototype.inline_code_pre=function(process){process.out('<tt class="inline-code">')},HtmlBuilder.prototype.inline_code_post=function(process){process.out("</tt>")},HtmlBuilder.prototype.inline_href=function(process,node){var href=nodeContentToString(process,node),text=href;return-1!==href.indexOf(",")&&(text=href.slice(href.indexOf(",")+1).trimLeft(),href=href.slice(0,href.indexOf(","))),process.out('<a href="'+href+'" class="link">').out(text).out("</a>"),!1},HtmlBuilder.prototype.block_label=function(process,node){return process.out('<a id="').out(node.args[0].arg).out('"></a>\n'),!1},HtmlBuilder.prototype.inline_tt_pre=function(process){process.out("<tt>")},HtmlBuilder.prototype.inline_tt_post=function(process){process.out("</tt>")},HtmlBuilder.prototype.inline_ruby_pre=function(process,node){return process.out("<ruby>"),function(){node.childNodes.forEach(function(node){var contentString=nodeContentToString(process,node),keywordData=contentString.split(",");process.out("<rb>").out(keywordData[0]).out("</rb>"),process.out("<rp>ï¼</rp><rt>"),process.out(keywordData[1]),process.out("</rt><rp>ï¼</rp>")})}},HtmlBuilder.prototype.inline_ruby_post=function(process){process.out("</ruby>")},HtmlBuilder.prototype.inline_u_pre=function(process){process.out("<u>")},HtmlBuilder.prototype.inline_u_post=function(process){process.out("</u>")},HtmlBuilder.prototype.inline_kw_pre=function(process,node){return process.out('<b class="kw">'),function(){node.childNodes.forEach(function(node){var contentString=nodeContentToString(process,node),keywordData=contentString.split(",");process.out(keywordData[0]+" ("+keywordData[1].trimLeft()+")")})}},HtmlBuilder.prototype.inline_kw_post=function(process,node){var contentString=nodeContentToString(process,node),keywordData=contentString.split(",");process.out("</b>").out("<!-- IDX:").out(keywordData[0]).out(" -->")},HtmlBuilder.prototype.inline_em_pre=function(process){process.out("<em>")},HtmlBuilder.prototype.inline_em_post=function(process){process.out("</em>")},HtmlBuilder.prototype.block_image=function(process,node){var chapterFileName=process.base.chapter.name,chapterName=chapterFileName.substring(0,chapterFileName.length-3),imagePath="images/"+chapterName+"-"+node.args[0].arg+".png",caption=node.args[1].arg,scale=1;if(node.args[2]){var regexp=(node.args[2].arg,new RegExp("scale=(\\d+(?:\\.\\d+))")),result=regexp.exec(node.args[2].arg);result&&(scale=parseFloat(result[1]))}return process.out('<div class="image">\n'),process.out('<img src="'+imagePath+'" alt="'+caption+'" width="'+100*scale+'%" />\n'),process.out('<p class="caption">\n'),process.out("å³").out(process.base.chapter.no).out(".").out(node.no).out(": ").out(caption),process.out("\n</p>\n"),process.out("</div>\n"),!1},HtmlBuilder.prototype.block_indepimage=function(process,node){var chapterFileName=process.base.chapter.name,chapterName=chapterFileName.substring(0,chapterFileName.length-3),imagePath="images/"+chapterName+"-"+node.args[0].arg+".png",caption="";node.args[1]&&(caption=node.args[1].arg);var scale=1;if(node.args[2]){var regexp=(node.args[2].arg,new RegExp("scale=(\\d+(?:\\.\\d+))")),result=regexp.exec(node.args[2].arg);result&&(scale=parseFloat(result[1]))}return process.out('<div class="image">\n'),1!==scale?process.out('<img src="'+imagePath+'" alt="'+caption+'" width="'+100*scale+'%" />\n'):process.out('<img src="'+imagePath+'" alt="'+caption+'" />\n'),node.args[1]&&(process.out('<p class="caption">\n'),process.out("å³: ").out(caption),process.out("\n</p>\n")),process.out("</div>\n"),!1},HtmlBuilder.prototype.inline_img=function(process,node){var imgNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out("å³").out(process.base.chapter.no).out(".").out(imgNode.no),!1},HtmlBuilder.prototype.inline_icon=function(process,node){var chapterFileName=process.base.chapter.name,chapterName=chapterFileName.substring(0,chapterFileName.length-3),imageName=nodeContentToString(process,node),imagePath="images/"+chapterName+"-"+imageName+".png";return process.out('<img src="').out(imagePath).out('" alt="[').out(imageName).out(']" />'),!1},HtmlBuilder.prototype.block_footnote=function(process,node){return process.out('<div class="footnote"><p class="footnote">[<a id="fn-'),process.out(node.args[0].arg).out('">*').out(node.no).out("</a>] "),process.out(node.args[1].arg),process.out("</p></div>\n"),!1},HtmlBuilder.prototype.inline_fn=function(process,node){var footnoteNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out('<a href="#fn-').out(footnoteNode.args[0].arg).out('">*').out(footnoteNode.no).out("</a>"),!1},HtmlBuilder.prototype.block_lead_pre=function(process){process.out('<div class="lead">\n')},HtmlBuilder.prototype.block_lead_post=function(process){process.out("</div>\n")},HtmlBuilder.prototype.inline_tti_pre=function(process){process.out("<tt><i>")},HtmlBuilder.prototype.inline_tti_post=function(process){process.out("</i></tt>")},HtmlBuilder.prototype.inline_ttb_pre=function(process){process.out("<tt><b>")},HtmlBuilder.prototype.inline_ttb_post=function(process){process.out("</b></tt>")},HtmlBuilder.prototype.block_noindent=function(){return!1},HtmlBuilder.prototype.block_source_pre=function(process,node){return process.out('<div class="source-code">\n'),process.out('<p class="caption">').out(node.args[0].arg).out("</p>\n"),process.out('<pre class="source">'),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_source_post=function(process){process.out("\n</pre>\n").out("</div>\n")},HtmlBuilder.prototype.block_cmd_pre=function(process,node){return process.out('<div class="cmd-code">\n'),process.out('<pre class="cmd">'),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_cmd_post=function(process){process.out("\n</pre>\n").out("</div>\n")},HtmlBuilder.prototype.block_quote_pre=function(process,node){return process.out("<blockquote><p>"),function(v){node.childNodes.forEach(function(node){ReVIEW.visit(node,v)})}},HtmlBuilder.prototype.block_quote_post=function(process){process.out("</p></blockquote>\n")},HtmlBuilder.prototype.inline_ami_pre=function(process){process.out('<span class="ami">')},HtmlBuilder.prototype.inline_ami_post=function(process){process.out("</span>")},HtmlBuilder.prototype.inline_bou_pre=function(process){process.out('<span class="bou">')},HtmlBuilder.prototype.inline_bou_post=function(process){process.out("</span>")},HtmlBuilder.prototype.inline_i_pre=function(process){process.out("<i>")},HtmlBuilder.prototype.inline_i_post=function(process){process.out("</i>")},HtmlBuilder.prototype.inline_strong_pre=function(process){process.out("<strong>")},HtmlBuilder.prototype.inline_strong_post=function(process){process.out("</strong>")},HtmlBuilder.prototype.inline_uchar_pre=function(process){process.out("&#x")},HtmlBuilder.prototype.inline_uchar_post=function(process){process.out(";")},HtmlBuilder}(Build.DefaultBuilder));Build.HtmlBuilder=HtmlBuilder}(ReVIEW.Build||(ReVIEW.Build={}));ReVIEW.Build}(ReVIEW||(ReVIEW={}));var ReVIEW;if(function(ReVIEW){function start(setup,options){var controller=new ReVIEW.Controller(options);return setup(controller),controller.process()}ReVIEW.start=start}(ReVIEW||(ReVIEW={})),ReVIEW.isNodeJS()&&(module.exports=ReVIEW),ReVIEW.isNodeJS()){var fs=require("fs"),packageJson;packageJson=fs.existsSync(__dirname+"/../package.json")?JSON.parse(fs.readFileSync(__dirname+"/../package.json","utf8")):{version:"develop"};var program=require("commander");program.version(packageJson.version,"-v, --version").option("--reviewfile <file>","where is ReVIEWconfig.js?").option("--base <path>","alternative base path"),program.command("compile <document>").description("compile ReVIEW document").option("--ast","output JSON format abstract syntax tree").option("-t, --target <target>","output format of document").action(function(document,options){var target=(!!options.ast,options.target||"html"),targetPath=process.cwd()+"/"+document;fs.existsSync(targetPath)||(console.error(targetPath+" not exists"),process.exit(1));var input=fs.readFileSync(targetPath,"utf8"),result=ReVIEW.Exec.singleCompile(input,document,target,null);result.success(function(result){result.book.parts[0].chapters[0].builderProcesses.forEach(function(process){console.log(process.result)}),process.exit(0)}),result.failure(function(result){result.book.reports.forEach(function(report){var log;switch(report.level){case ReVIEW.ReportLevel.Info:log=console.log;case ReVIEW.ReportLevel.Warning:log=console.warn;case ReVIEW.ReportLevel.Error:log=console.error}var message="";report.nodes.forEach(function(node){message+="["+node.line+","+node.column+"] "}),message+=report.message,log(message)}),process.exit(1)})}),program.command("*").action(function(){var reviewfile=program.reviewfile||"./ReVIEWconfig.js",setup=require(reviewfile);ReVIEW.start(setup,{reviewfile:reviewfile,base:program.base})});var endWith=function(str,target){return-1!==str.indexOf(target,str.length-target.length)};endWith(process.argv[1],"reviewjs")&&program.parse(process.argv)}